<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="T_SXAPPROVALREPORT_SqlMap">
 <resultMap id="sxApprovalReport" class="com.gotop.reportjbpm.model.SxApprovalReport" >
    <!--Bean方式返回全表-->
    <result column="ONECATEGORY" property="oneCategory" jdbcType="VARCHAR" />
  </resultMap>
  
  
  
  	<!-- 查询时限情况统计报表标题头 -->
	<select id="querySxApprovalReportTitleList" parameterClass="java.util.HashMap" resultMap="sxApprovalReport">
	SELECT DISTINCT DICTTYPEID || DICTID||'Num' oneCategoryNum,DICTTYPEID || DICTID||'Moneny' oneCategoryMoney, ONECATEGORY
   FROM T_GENERALPROCESS_MODELONE T,
        T_PROCESS_TASK_ASSIGNEE   P1,
        EOS_DICT_ENTRY            E
  WHERE T.FLOW_ID = P1.EXECUTION_ID
    AND T.ONECATEGORY = E.DICTNAME
    AND DICTTYPEID = 'PROCESS_onecategory'
    AND P1.NEXT_ACTIVITY_NAME = '结束'
    AND P1.BUSINESS_TYPE = '88'
    order by ONECATEGORY
	
	</select>
      
     
	 
	
  
  
  	<!-- 查询时限情况统计报表 -->
	<select id="querySxApprovalReportList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	SELECT ORGCODEONE,
       DECODE(GROUPING(ORGCODEONE) + GROUPING(ORGCODETWO),
              1,
              '小计',
              2,
              '合计',
              ORGCODETWO),
      $fourParams$
  FROM (SELECT T.ORGCODEONE,
               T.ORGCODETWO,
               T.ONECATEGORY,
               NVL(V_NUM, 0) V_NUM,
               NVL(AMT, 0) AMT
          FROM (SELECT A.ORGCODEONE, A.ORGCODETWO, B.ONECATEGORY
                  FROM (SELECT DISTINCT ORGCODEONE, ORGCODETWO
                          FROM T_GENERALPROCESS_MODELONE) A,
                       (SELECT DISTINCT ONECATEGORY
                          FROM T_GENERALPROCESS_MODELONE) B) T
          LEFT JOIN (SELECT T.ORGCODEONE,
                           T.ORGCODETWO,
                           T.ONECATEGORY,
                           COUNT(*) V_NUM,
                           SUM(T.APPLY_BAL) AMT
                      FROM T_GENERALPROCESS_MODELONE T,
                           OM_EMPLOYEE               E1,
                           T_PROCESS_TASK_ASSIGNEE   P1
                     WHERE T.CREATOR = E1.EMPID
                       AND T.FLOW_ID = P1.EXECUTION_ID
                       AND P1.NEXT_ACTIVITY_NAME = '结束'
                       AND P1.BUSINESS_TYPE = '88'
                     GROUP BY T.ORGCODEONE, T.ORGCODETWO, T.ONECATEGORY) TT
            ON CONCAT(CONCAT(T.ORGCODEONE, T.ORGCODETWO), T.ONECATEGORY) =
               CONCAT(CONCAT(TT.ORGCODEONE, TT.ORGCODETWO), TT.ONECATEGORY))
PIVOT(SUM(V_NUM) A, SUM(AMT) B
   FOR ONECATEGORY IN($oneParams$))
 GROUP BY GROUPING SETS((ORGCODEONE, ORGCODETWO,$threeParams$),(ORGCODEONE),())
 ORDER BY ORGCODEONE, ORGCODETWO
	</select>



 
	 
	 <resultMap id="sxApprovalReport2" class="com.gotop.reportjbpm.model.SxApprovalReport" >
    <!--Bean方式返回全表-->
    <result column="ORGNAMEONE" property="orgNameOne" jdbcType="VARCHAR" />
    <result column="ORGCODEONE" property="orgCodeOne" jdbcType="VARCHAR" />
    <result column="orgCodeTwoRows" property="orgCodeTwoRows" jdbcType="VARCHAR" />
  </resultMap>
  
  
  
  	<!-- 查询时限情况统计报表一级支行列名 -->
	<select id="querySxApprovalReportOrgNameOneList" parameterClass="java.util.HashMap" resultMap="sxApprovalReport2">
		SELECT DECODE(GROUPING(T.ORGNAMEONE), 1, '合计', T.ORGNAMEONE) ORGNAMEONE,
       T.DISPLAYORDER,
       T.ORGCODE ORGCODEONE,
       DECODE(GROUPING(TOTAL), 1, SUM(NVL(TT.TOTAL, 0)), NVL(TOTAL, 0)) ORGCODETWOROWS
  FROM (SELECT O1.ORGNAME AS ORGNAMEONE, O1.DISPLAYORDER, O1.ORGCODE
          FROM T_GENERALPROCESS_MODELONE T,
               OM_ORGANIZATION           O1,
               T_PROCESS_TASK_ASSIGNEE   P1
         WHERE T.ORGCODEONE = O1.ORGCODE
           AND T.FLOW_ID = P1.EXECUTION_ID
           AND P1.NEXT_ACTIVITY_NAME = '结束'
           AND P1.BUSINESS_TYPE = '88'
         GROUP BY O1.ORGNAME, O1.DISPLAYORDER, O1.ORGCODE) T,
       (SELECT ORGCODEONE, COUNT(*) TOTAL
          FROM (SELECT ORGCODEONE
                  FROM T_GENERALPROCESS_MODELONE
                 WHERE LENGTH(ORGCODETWO) = 8
                 GROUP BY ORGCODEONE, ORGCODETWO)
         GROUP BY ORGCODEONE) TT
 WHERE T.ORGCODE = TT.ORGCODEONE(+)
 GROUP BY GROUPING SETS((ORGNAMEONE, ORGCODE, DISPLAYORDER, TOTAL),())
 order by DISPLAYORDER
	 
	
	</select>
</sqlMap>
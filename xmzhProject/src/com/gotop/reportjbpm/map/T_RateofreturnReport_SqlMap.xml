<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="T_RateofreturnReport_SqlMap">
 <resultMap id="RateofreturnReport" class="com.gotop.reportjbpm.model.RateofreturnReport" >
    <!--Bean方式返回全表-->
    
    <result column="ONECATEGORY" property="oneCategory" jdbcType="VARCHAR" />
    <result column="LOANCATEGORY" property="loanCategory" jdbcType="VARCHAR" />
    <result column="ORGCODEONE" property="orgCodeOne" jdbcType="VARCHAR" />
    <result column="ORGNAMEONE" property="orgNameOne" jdbcType="VARCHAR" />
    <result column="ORGCODETWO" property="orgCodeTwo" jdbcType="VARCHAR" />
    <result column="ORGNAMETWO" property="orgNameTwo" jdbcType="VARCHAR" />
    <result column="passNumber" property="passNumber" jdbcType="VARCHAR" />
    <result column="backOne" property="backOne" jdbcType="FLOAT" />
    <result column="backTwo" property="backTwo" jdbcType="FLOAT" />
    <result column="backThree" property="backThree" jdbcType="FLOAT" />
    <result column="backFour" property="backFour" jdbcType="FLOAT" />
  </resultMap>
  
<!-- 查询退单率合计 -->
	 <resultMap id="RateofreturnReport2" class="com.gotop.reportjbpm.model.RateofreturnReport" >
    <result column="heJi" property="heJi" jdbcType="VARCHAR" />
        <result column="backOne" property="backOne" jdbcType="FLOAT" />
    <result column="backTwo" property="backTwo" jdbcType="FLOAT" />
    <result column="backThree" property="backThree" jdbcType="FLOAT" />
    <result column="backFour" property="backFour" jdbcType="FLOAT" />
  </resultMap>
  
  
	<!-- 查询退单率列表 -->
	<select id="RateofreturnReportList" resultMap="RateofreturnReport" parameterClass="java.util.HashMap">

SELECT
	ONECATEGORY,
	LOANCATEGORY,
	ORGCODEONE,
	ORGNAMEONE,
	ORGCODETWO,
	ORGNAMETWO,
	M passNumber,
 backOne,
backTwo,
 backThree,
backFour
FROM
	(
		SELECT
			LOANCATEGORY,
			ORGCODEONE,
			ORGNAMEONE,
			ORGCODETWO,
			ORGNAMETWO,
			M,
			ONECATEGORY,
			nvl(backOne,'0') as  backOne,
			nvl(	backTwo,'0') backTwo ,
			nvl(	backThree,'0') backThree,
			nvl(	backFour,'0') backFour
		FROM
			(
				SELECT
					tm.LOANCATEGORY,
					tm.ORGCODEONE,
					tm.ORGNAMEONE,
					tm.ORGCODETWO,
					tm.ORGNAMETWO,
					tm. M,
					tm.ONECATEGORY,
					(ROUND(tn1.n1 / tm. M * 100, 2)) backOne,
					(ROUND(tn2.n2 / tm. M * 100, 2)) backTwo,
					(ROUND(tn3.n3 / tm. M * 100, 2))  backThree,
					(ROUND(tn4.n4 / tm. M * 100, 2))  backFour
				FROM
					(
						SELECT
							COUNT (*) M,
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							ONECATEGORY
						FROM
							(
								SELECT
									t1.LOANCATEGORY,
									t1.ONECATEGORY,
									t2.ORGCODEONE,
									t2.ORGNAMEONE,
									t3.ORGCODETWO,
									t3.ORGNAMETWO,
									t5.end_
								FROM
									(
										SELECT
											flow_id,
											ORGCODEONE,
											ORGCODETWO,
											LOANCATEGORY,
											ONECATEGORY
										FROM
											T_GENERALPROCESS_MODELONE
									) t1
								JOIN (
									SELECT
										ORGCODE as ORGCODEONE,
										ORGNAME as ORGNAMEONE
									FROM
										OM_ORGANIZATION
								) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
								LEFT JOIN (
									SELECT
										ORGCODE AS ORGCODETWO,
										ORGNAME AS ORGNAMETWO
									FROM
										OM_ORGANIZATION
								) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
								JOIN (
									SELECT
										A .execution_ f_id
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_   like '%结束%'
									AND A .execution_ IN (
										SELECT
											T .execution_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									) 
								) t4 ON t1.flow_id = t4.f_id
								JOIN (
									SELECT
										execution_,
										MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									AND execution_ IN (
										SELECT
											execution_
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ like '%结束%'
									) 
									GROUP BY
										execution_
								) t5 ON t1.flow_id = t5.execution_
							)
						WHERE
							ORGNAMETWO IS NOT NULL
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
						GROUP BY
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							ONECATEGORY
					) tm
				LEFT JOIN (
					SELECT
						COUNT (*) n1,
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
					FROM
						(
							SELECT
								ttn.LOANCATEGORY,
								ttn.ORGCODEONE,
								ttn.ORGNAMEONE,
								ttn.ORGCODETWO,
								ttn.ORGNAMETWO,
								ttn.reportcnt,
								ttn.flow_id,
								ttn.end_,
								ttn.ONECATEGORY
							FROM
								(
									SELECT
										t1.flow_id,
										t1.LOANCATEGORY,
										t1.ONECATEGORY,
										t2.ORGCODEONE,
										t2.ORGNAMEONE,
										t3.ORGCODETWO,
										t3.ORGNAMETWO,
										t5.reportcnt,
										t6.end_
									FROM
										(
											SELECT
												flow_id,
												ORGCODEONE,
												ORGCODETWO,
												LOANCATEGORY,
												ONECATEGORY
											FROM
												T_GENERALPROCESS_MODELONE
										) t1
									JOIN (
										SELECT
											ORGCODE as ORGCODEONE,
											ORGNAME as ORGNAMEONE
										FROM
											OM_ORGANIZATION
									) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
									LEFT JOIN (
										SELECT
											ORGCODE AS ORGCODETWO,
											ORGNAME AS ORGNAMETWO
										FROM
											OM_ORGANIZATION
									) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
									JOIN (
										SELECT
											A .execution_ f_id
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ like '%结束%'
										AND A .execution_ IN (
											SELECT
												T .execution_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										)
									) t4 ON t1.flow_id = t4.f_id
									JOIN (
										SELECT
											reportcnt,
											flow_id
										FROM
											T_GENERALPROCESS_MODELTHREE
									) t5 ON t1.flow_id = t5.flow_id
									JOIN (
										SELECT
											execution_,
											MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										AND execution_ IN (
											SELECT
												execution_
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_ like '%结束%'
										)
										GROUP BY
											execution_
									) t6 ON t6.execution_ = t1.flow_id
								) ttn
						)
					WHERE
						reportcnt = '2'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
					GROUP BY
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
				) tn1 ON tm.LOANCATEGORY = tn1.LOANCATEGORY
				AND tm.ORGNAMEONE = tn1.ORGNAMEONE
				AND tm.ONECATEGORY = tn1.ONECATEGORY
				AND (
					tn1.ORGNAMETWO IS NOT NULL
					AND tm.ORGNAMETWO = tn1.ORGNAMETWO
				)
				LEFT JOIN (
					SELECT
						COUNT (*) n2,
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
					FROM
						(
							SELECT
								ttn.LOANCATEGORY,
								ttn.ORGCODEONE,
								ttn.ORGNAMEONE,
								ttn.ORGCODETWO,
								ttn.ORGNAMETWO,
								ttn.reportcnt,
								ttn.flow_id,
								ttn.end_,
								ttn.ONECATEGORY
							FROM
								(
									SELECT
										t1.flow_id,
										t1.LOANCATEGORY,
										t1.ONECATEGORY,
										t2.ORGCODEONE,
										t2.ORGNAMEONE,
										t3.ORGCODETWO,
										t3.ORGNAMETWO,
										t5.reportcnt,
										t6.end_
									FROM
										(
											SELECT
												flow_id,
												ORGCODEONE,
												ORGCODETWO,
												LOANCATEGORY,
												ONECATEGORY
											FROM
												T_GENERALPROCESS_MODELONE
										) t1
									JOIN (
										SELECT
											ORGCODE AS ORGCODEONE ,
											ORGNAME AS ORGNAMEONE
										FROM
											OM_ORGANIZATION
									) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
									LEFT JOIN (
										SELECT
											ORGCODE AS ORGCODETWO,
											ORGNAME AS ORGNAMETWO
										FROM
											OM_ORGANIZATION
									) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
									JOIN (
										SELECT
											A .execution_ f_id
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_  like '%结束%'
										AND A .execution_ IN (
											SELECT
												T .execution_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										)
									) t4 ON t1.flow_id = t4.f_id
									JOIN (
										SELECT
											reportcnt,
											flow_id
										FROM
											T_GENERALPROCESS_MODELTHREE
									) t5 ON t1.flow_id = t5.flow_id
									JOIN (
										SELECT
											execution_,
											MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										AND execution_ IN (
											SELECT
												execution_
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
										)
										GROUP BY
											execution_
									) t6 ON t6.execution_ = t1.flow_id
								) ttn
						)
					WHERE
						reportcnt = '3'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
					GROUP BY
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
				) tn2 ON tm.LOANCATEGORY = tn2.LOANCATEGORY
				AND tm.ORGNAMEONE = tn2.ORGNAMEONE
				AND tm.ONECATEGORY = tn2.ONECATEGORY
				AND (
					tn2.ORGNAMETWO IS NOT NULL
					AND tm.ORGNAMETWO = tn2.ORGNAMETWO
				)
				LEFT JOIN (
					SELECT
						COUNT (*) n3,
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
					FROM
						(
							SELECT
								ttn.LOANCATEGORY,
								ttn.ORGCODEONE,
								ttn.ORGNAMEONE,
								ttn.ORGCODETWO,
								ttn.ORGNAMETWO,
								ttn.reportcnt,
								ttn.flow_id,
								ttn.end_,
								ttn.ONECATEGORY
							FROM
								(
									SELECT
										t1.flow_id,
										t1.LOANCATEGORY,
										t1.ONECATEGORY,
										t2.ORGCODEONE,
										t2.ORGNAMEONE,
										t3.ORGCODETWO,
										t3.ORGNAMETWO,
										t5.reportcnt,
										t6.end_
									FROM
										(
											SELECT
												flow_id,
												ORGCODEONE,
												ORGCODETWO,
												LOANCATEGORY,
												ONECATEGORY
											FROM
												T_GENERALPROCESS_MODELONE
										) t1
									JOIN (
										SELECT
											ORGCODE AS ORGCODEONE,
											ORGNAME AS ORGNAMEONE
										FROM
											OM_ORGANIZATION
									) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
									LEFT JOIN (
										SELECT
											ORGCODE AS ORGCODETWO,
											ORGNAME AS ORGNAMETWO
										FROM
											OM_ORGANIZATION
									) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
									JOIN (
										SELECT
											A .execution_ f_id
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_  like '%结束%'
										AND A .execution_ IN (
											SELECT
												T .execution_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										)
									) t4 ON t1.flow_id = t4.f_id
									JOIN (
										SELECT
											reportcnt,
											flow_id
										FROM
											T_GENERALPROCESS_MODELTHREE
									) t5 ON t1.flow_id = t5.flow_id
									JOIN (
										SELECT
											execution_,
											MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										AND execution_ IN (
											SELECT
												execution_
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
										)
										GROUP BY
											execution_
									) t6 ON t6.execution_ = t1.flow_id
								) ttn
						)
					WHERE
						reportcnt = '4'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
					GROUP BY
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
				) tn3 ON tm.LOANCATEGORY = tn3.LOANCATEGORY
				AND tm.ORGNAMEONE = tn3.ORGNAMEONE
				AND tm.ONECATEGORY = tn3.ONECATEGORY
				AND (
					tn3.ORGNAMETWO IS NOT NULL
					AND tm.ORGNAMETWO = tn3.ORGNAMETWO
				)
				LEFT JOIN (
					SELECT
						COUNT (*) n4,
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
					FROM
						(
							SELECT
								ttn.LOANCATEGORY,
								ttn.ORGCODEONE,
								ttn.ORGNAMEONE,
								ttn.ORGCODETWO,
								ttn.ORGNAMETWO,
								ttn.reportcnt,
								ttn.flow_id,
								ttn.end_,
								ttn.ONECATEGORY
							FROM
								(
									SELECT
										t1.flow_id,
										t1.LOANCATEGORY,
										t1.ONECATEGORY,
										t2.ORGCODEONE,
										t2.ORGNAMEONE,
										t3.ORGCODETWO,
										t3.ORGNAMETWO,
										t5.reportcnt,
										t6.end_
									FROM
										(
											SELECT
												flow_id,
												ORGCODEONE,
												ORGCODETWO,
												LOANCATEGORY,
												ONECATEGORY
											FROM
												T_GENERALPROCESS_MODELONE
										) t1
									JOIN (
										SELECT
											ORGCODE AS ORGCODEONE,
											ORGNAME AS ORGNAMEONE
										FROM
											OM_ORGANIZATION
									) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
									LEFT JOIN (
										SELECT
											ORGCODE AS ORGCODETWO,
											ORGNAME AS ORGNAMETWO
										FROM
											OM_ORGANIZATION
									) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
									JOIN (
										SELECT
											A .execution_ f_id
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_  like '%结束%'
										AND A .execution_ IN (
											SELECT
												T .execution_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										)
									) t4 ON t1.flow_id = t4.f_id
									JOIN (
										SELECT
											reportcnt,
											flow_id
										FROM
											T_GENERALPROCESS_MODELTHREE
									) t5 ON t1.flow_id = t5.flow_id
									JOIN (
										SELECT
											execution_,
											MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										AND execution_ IN (
											SELECT
												execution_
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_   like '%结束%'
										)
										GROUP BY
											execution_
									) t6 ON t6.execution_ = t1.flow_id
								) ttn
						)
					WHERE
						reportcnt = '5'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
					GROUP BY
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						reportcnt,
						ONECATEGORY
				) tn4 ON tm.LOANCATEGORY = tn4.LOANCATEGORY
				AND tm.ORGNAMEONE = tn4.ORGNAMEONE
				AND tm.ONECATEGORY = tn4.ONECATEGORY
				AND (
					tn4.ORGNAMETWO IS NOT NULL
					AND tm.ORGNAMETWO = tn4.ORGNAMETWO
				)
			)
		UNION
			SELECT
				LOANCATEGORY,
				ORGCODEONE,
				ORGNAMEONE,
				ORGCODETWO,
				ORGNAMETWO,
				M,
				ONECATEGORY,
			nvl(backOne,'0') as  backOne,
			nvl(	backTwo,'0') backTwo ,
			nvl(	backThree,'0') backThree,
			nvl(	backFour,'0') backFour
			FROM
				(
					SELECT
						tm.LOANCATEGORY,
						tm.ORGCODEONE,
						tm.ORGNAMEONE,
						tm.ORGCODETWO,
						tm.ORGNAMETWO,
						tm. M,
						tm.ONECATEGORY,
						(ROUND(tn1.n1 / tm. M * 100, 2)) backOne,
						(ROUND(tn2.n2 / tm. M * 100, 2)) backTwo,
						(ROUND(tn3.n3 / tm. M * 100, 2))  backThree,
						(ROUND(tn4.n4 / tm. M * 100, 2)) backFour
					FROM
						(
							SELECT
								COUNT (*) M,
								LOANCATEGORY,
								ORGCODEONE,
								ORGNAMEONE,
								ORGCODETWO,
								ORGNAMETWO,
								ONECATEGORY
							FROM
								(
									SELECT
										t1.LOANCATEGORY,
										t1.ONECATEGORY,
										t2.ORGCODEONE,
										t2.ORGNAMEONE,
										t3.ORGCODETWO,
										t3.ORGNAMETWO,
										t5.end_
									FROM
										(
											SELECT
												flow_id,
												ORGCODEONE,
												ORGCODETWO,
												LOANCATEGORY,
												ONECATEGORY
											FROM
												T_GENERALPROCESS_MODELONE
										) t1
									JOIN (
										SELECT
											ORGCODE AS ORGCODEONE,
											ORGNAME AS ORGNAMEONE
										FROM
											OM_ORGANIZATION
									) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
									LEFT JOIN (
										SELECT
											ORGCODE AS ORGCODETWO,
											ORGNAME AS ORGNAMETWO
										FROM
											OM_ORGANIZATION
									) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
									JOIN (
										SELECT
											A .execution_ f_id
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_  like '%结束%'
										AND A .execution_ IN (
											SELECT
												T .execution_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										) 
									) t4 ON t1.flow_id = t4.f_id
									JOIN (
										SELECT
											execution_,
											MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
										AND execution_ IN (
											SELECT
												execution_
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
										) 
										GROUP BY
											execution_
									) t5 ON t1.flow_id = t5.execution_
								)
							WHERE
								ORGNAMETWO IS NULL
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
							GROUP BY
								LOANCATEGORY,
								ORGCODEONE,
								ORGNAMEONE,
								ORGCODETWO,
								ORGNAMETWO,
								ONECATEGORY
						) tm
					LEFT JOIN (
						SELECT
							COUNT (*) n1,
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
						FROM
							(
								SELECT
									ttn.LOANCATEGORY,
									ttn.ORGCODEONE,
									ttn.ORGNAMEONE,
									ttn.ORGCODETWO,
									ttn.ORGNAMETWO,
									ttn.reportcnt,
									ttn.flow_id,
									ttn.end_,
									ttn.ONECATEGORY
								FROM
									(
										SELECT
											t1.flow_id,
											t1.LOANCATEGORY,
											t1.ONECATEGORY,
											t2.ORGCODEONE,
											t2.ORGNAMEONE,
											t3.ORGCODETWO,
											t3.ORGNAMETWO,
											t5.reportcnt,
											t6.end_
										FROM
											(
												SELECT
													flow_id,
													ORGCODEONE,
													ORGCODETWO,
													LOANCATEGORY,
													ONECATEGORY
												FROM
													T_GENERALPROCESS_MODELONE
											) t1
										JOIN (
											SELECT
												ORGCODE AS ORGCODEONE,
												ORGNAME AS ORGNAMEONE
											FROM
												OM_ORGANIZATION
										) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
										LEFT JOIN (
											SELECT
												ORGCODE AS ORGCODETWO,
												ORGNAME AS ORGNAMETWO
											FROM
												OM_ORGANIZATION
										) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
										JOIN (
											SELECT
												A .execution_ f_id
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
											AND A .execution_ IN (
												SELECT
													T .execution_
												FROM
													jbpm4_hist_actinst T
												WHERE
													T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											)
										) t4 ON t1.flow_id = t4.f_id
										JOIN (
											SELECT
												reportcnt,
												flow_id
											FROM
												T_GENERALPROCESS_MODELTHREE
										) t5 ON t1.flow_id = t5.flow_id
										JOIN (
											SELECT
												execution_,
												MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											AND execution_ IN (
												SELECT
													execution_
												FROM
													jbpm4_hist_actinst A
												WHERE
													A .transition_  like '%结束%'
											)
											GROUP BY
												execution_
										) t6 ON t6.execution_ = t1.flow_id
									) ttn
							)
						WHERE
							reportcnt = '2'

		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
						GROUP BY
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
					) tn1 ON tm.LOANCATEGORY = tn1.LOANCATEGORY
					AND tm.ORGNAMEONE = tn1.ORGNAMEONE
					AND tm.ONECATEGORY = tn1.ONECATEGORY
					AND tn1.ORGNAMETWO IS NULL
					LEFT JOIN (
						SELECT
							COUNT (*) n2,
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
						FROM
							(
								SELECT
									ttn.LOANCATEGORY,
									ttn.ORGCODEONE,
									ttn.ORGNAMEONE,
									ttn.ORGCODETWO,
									ttn.ORGNAMETWO,
									ttn.reportcnt,
									ttn.flow_id,
									ttn.end_,
									ttn.ONECATEGORY
								FROM
									(
										SELECT
											t1.flow_id,
											t1.LOANCATEGORY,
											t1.ONECATEGORY,
											t2.ORGCODEONE,
											t2.ORGNAMEONE,
											t3.ORGCODETWO,
											t3.ORGNAMETWO,
											t5.reportcnt,
											t6.end_
										FROM
											(
												SELECT
													flow_id,
													ORGCODEONE,
													ORGCODETWO,
													LOANCATEGORY,
													ONECATEGORY
												FROM
													T_GENERALPROCESS_MODELONE
											) t1
										JOIN (
											SELECT
												ORGCODE AS ORGCODEONE,
												ORGNAME AS ORGNAMEONE
											FROM
												OM_ORGANIZATION
										) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
										LEFT JOIN (
											SELECT
												ORGCODE AS ORGCODETWO,
												ORGNAME AS ORGNAMETWO
											FROM
												OM_ORGANIZATION
										) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
										JOIN (
											SELECT
												A .execution_ f_id
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
											AND A .execution_ IN (
												SELECT
													T .execution_
												FROM
													jbpm4_hist_actinst T
												WHERE
													T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											)
										) t4 ON t1.flow_id = t4.f_id
										JOIN (
											SELECT
												reportcnt,
												flow_id
											FROM
												T_GENERALPROCESS_MODELTHREE
										) t5 ON t1.flow_id = t5.flow_id
										JOIN (
											SELECT
												execution_,
												MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											AND execution_ IN (
												SELECT
													execution_
												FROM
													jbpm4_hist_actinst A
												WHERE
													A .transition_  like '%结束%'
											)
											GROUP BY
												execution_
										) t6 ON t6.execution_ = t1.flow_id
									) ttn
							)
						WHERE
							reportcnt = '3'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
						GROUP BY
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
					) tn2 ON tm.LOANCATEGORY = tn2.LOANCATEGORY
					AND tm.ORGNAMEONE = tn2.ORGNAMEONE
					AND tm.ONECATEGORY = tn2.ONECATEGORY
					AND tn2.ORGNAMETWO IS NULL
					LEFT JOIN (
						SELECT
							COUNT (*) n3,
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
				
							ONECATEGORY
						FROM
							(
								SELECT
									ttn.LOANCATEGORY,
									ttn.ORGCODEONE,
									ttn.ORGNAMEONE,
									ttn.ORGCODETWO,
									ttn.ORGNAMETWO,
									ttn.reportcnt,
									ttn.flow_id,
									ttn.end_,
									ttn.ONECATEGORY
								FROM
									(
										SELECT
											t1.flow_id,
											t1.LOANCATEGORY,
											t1.ONECATEGORY,
											t2.ORGCODEONE,
											t2.ORGNAMEONE,
											t3.ORGCODETWO,
											t3.ORGNAMETWO,
											t5.reportcnt,
											t6.end_
										FROM
											(
												SELECT
													flow_id,
													ORGCODEONE,
													ORGCODETWO,
													LOANCATEGORY,
													ONECATEGORY
												FROM
													T_GENERALPROCESS_MODELONE
											) t1
										JOIN (
											SELECT
												ORGCODE AS ORGCODEONE,
												ORGNAME AS ORGNAMEONE
											FROM
												OM_ORGANIZATION
										) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
										LEFT JOIN (
											SELECT
												ORGCODE AS ORGCODETWO,
												ORGNAME AS ORGNAMETWO
											FROM
												OM_ORGANIZATION
										) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
										JOIN (
											SELECT
												A .execution_ f_id
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
											AND A .execution_ IN (
												SELECT
													T .execution_
												FROM
													jbpm4_hist_actinst T
												WHERE
													T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											)
										) t4 ON t1.flow_id = t4.f_id
										JOIN (
											SELECT
												reportcnt,
												flow_id
											FROM
												T_GENERALPROCESS_MODELTHREE
										) t5 ON t1.flow_id = t5.flow_id
										JOIN (
											SELECT
												execution_,
												MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											AND execution_ IN (
												SELECT
													execution_
												FROM
													jbpm4_hist_actinst A
												WHERE
													A .transition_  like '%结束%'
											)
											GROUP BY
												execution_
										) t6 ON t6.execution_ = t1.flow_id
									) ttn
							)
						WHERE
							reportcnt = '4'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
						GROUP BY
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
					) tn3 ON tm.LOANCATEGORY = tn3.LOANCATEGORY
					AND tm.ORGNAMEONE = tn3.ORGNAMEONE
					AND tm.ONECATEGORY = tn3.ONECATEGORY
					AND tn3.ORGNAMETWO IS NULL
					LEFT JOIN (
						SELECT
							COUNT (*) n4,
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
						FROM
							(
								SELECT
									ttn.LOANCATEGORY,
									ttn.ORGCODEONE,
									ttn.ORGNAMEONE,
									ttn.ORGCODETWO,
									ttn.ORGNAMETWO,
									ttn.reportcnt,
									ttn.flow_id,
									ttn.end_,
									ttn.ONECATEGORY
								FROM
									(
										SELECT
											t1.flow_id,
											t1.LOANCATEGORY,
											t1.ONECATEGORY,
											t2.ORGCODEONE,
											t2.ORGNAMEONE,
											t3.ORGCODETWO,
											t3.ORGNAMETWO,
											t5.reportcnt,
											t6.end_
										FROM
											(
												SELECT
													flow_id,
													ORGCODEONE,
													ORGCODETWO,
													LOANCATEGORY,
													ONECATEGORY
												FROM
													T_GENERALPROCESS_MODELONE
											) t1
										JOIN (
											SELECT
												ORGCODE AS ORGCODEONE,
												ORGNAME AS ORGNAMEONE
											FROM
												OM_ORGANIZATION
										) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
										LEFT JOIN (
											SELECT
												ORGCODE AS ORGCODETWO,
												ORGNAME AS ORGNAMETWO
											FROM
												OM_ORGANIZATION
										) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
										JOIN (
											SELECT
												A .execution_ f_id
											FROM
												jbpm4_hist_actinst A
											WHERE
												A .transition_  like '%结束%'
											AND A .execution_ IN (
												SELECT
													T .execution_
												FROM
													jbpm4_hist_actinst T
												WHERE
													T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											)
										) t4 ON t1.flow_id = t4.f_id
										JOIN (
											SELECT
												reportcnt,
												flow_id
											FROM
												T_GENERALPROCESS_MODELTHREE
										) t5 ON t1.flow_id = t5.flow_id
										JOIN (
											SELECT
												execution_,
												MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
											FROM
												jbpm4_hist_actinst T
											WHERE
												T .ACTIVITY_NAME_ LIKE '%发起合同预审'
											AND execution_ IN (
												SELECT
													execution_
												FROM
													jbpm4_hist_actinst A
												WHERE
													A .transition_ like '%结束%'
											)
											GROUP BY
												execution_
										) t6 ON t6.execution_ = t1.flow_id
									) ttn
							)
						WHERE
							reportcnt = '5'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
						GROUP BY
							LOANCATEGORY,
							ORGCODEONE,
							ORGNAMEONE,
							ORGCODETWO,
							ORGNAMETWO,
							reportcnt,
							ONECATEGORY
					) tn4 ON tm.LOANCATEGORY = tn4.LOANCATEGORY
					AND tm.ORGNAMEONE = tn4.ORGNAMEONE
					AND tm.ONECATEGORY = tn4.ONECATEGORY
					AND tn4.ORGNAMETWO IS NULL
				)
	)

	</select>
	<!-- ============================================================================================== -->
	<!-- 查询退单率合计 -->
		<select id="RateofreturnReportListSum" resultMap="RateofreturnReport2" parameterClass="java.util.HashMap">
SELECT heji,			
	 		nvl(backOne,'0') as  backOne,
			nvl(	backTwo,'0') backTwo ,
			nvl(	backThree,'0') backThree,
			nvl(	backFour,'0') backFour
from
(		
SELECT heji,			
      (ROUND(backOne / heji * 100, 2))  backOne,
			(ROUND(backTwo / heji * 100, 2))  backTwo,
			(ROUND(backThree / heji * 100, 2))  backThree,
			(ROUND(backFour / heji * 100, 2))  backFour
from 
(
SELECT sum(M) heji,sum(backOne) backOne,sum(backTwo) backTwo,sum(backThree) backThree,sum(backFour) backFour
from 
(
SELECT
	tm.LOANCATEGORY,
	tm.ORGCODEONE,
	tm.ORGNAMEONE,
	tm.ORGCODETWO,
	tm.ORGNAMETWO,
	tm. M,
	tm.ONECATEGORY,
	tn1.n1  backOne,
	tn2.n2 backTwo,
	tn3.n3 backThree,
	tn4.n4 backFour
FROM
	(
		SELECT
			COUNT (*) M,
			LOANCATEGORY,
			ORGCODEONE,
			ORGNAMEONE,
			ORGCODETWO,
			ORGNAMETWO,
			ONECATEGORY
		FROM
			(
				SELECT
					t1.LOANCATEGORY,
					t1.ONECATEGORY,
					t2.ORGCODEONE,
					t2.ORGNAMEONE,
					t3.ORGCODETWO,
					t3.ORGNAMETWO,
					t5.end_
				FROM
					(
						SELECT
							flow_id,
							ORGCODEONE,
							ORGCODETWO,
							LOANCATEGORY,
							ONECATEGORY
						FROM
							T_GENERALPROCESS_MODELONE
					) t1
				JOIN (
					SELECT
						ORGCODE AS ORGCODEONE,
						ORGNAME AS ORGNAMEONE
					FROM
						OM_ORGANIZATION
				) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
				LEFT JOIN (
					SELECT
						ORGCODE AS ORGCODETWO,
						ORGNAME AS ORGNAMETWO
					FROM
						OM_ORGANIZATION
				) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
				JOIN (
					SELECT
						A .execution_ f_id
					FROM
						jbpm4_hist_actinst A
					WHERE
						A .transition_ LIKE '%结束%'
					AND A .execution_ IN (
						SELECT
							T .execution_
						FROM
							jbpm4_hist_actinst T
						WHERE
							T .ACTIVITY_NAME_ LIKE '%发起合同预审'
					)
				) t4 ON t1.flow_id = t4.f_id
				JOIN (
					SELECT
						execution_,
						MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
					FROM
						jbpm4_hist_actinst T
					WHERE
						T .ACTIVITY_NAME_ LIKE '%发起合同预审'
					AND execution_ IN (
						SELECT
							execution_
						FROM
							jbpm4_hist_actinst A
						WHERE
							A .transition_ LIKE '%结束%'
					)
					GROUP BY
						execution_
				) t5 ON t1.flow_id = t5.execution_
			)
		WHERE
			ORGNAMETWO IS NOT NULL
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
		GROUP BY
			LOANCATEGORY,
			ORGCODEONE,
			ORGNAMEONE,
			ORGCODETWO,
			ORGNAMETWO,
			ONECATEGORY
	) tm
LEFT JOIN (
	SELECT
		COUNT (*) n1,
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
	FROM
		(
			SELECT
				ttn.LOANCATEGORY,
				ttn.ORGCODEONE,
				ttn.ORGNAMEONE,
				ttn.ORGCODETWO,
				ttn.ORGNAMETWO,
				ttn.reportcnt,
				ttn.flow_id,
				ttn.end_,
				ttn.ONECATEGORY
			FROM
				(
					SELECT
						t1.flow_id,
						t1.LOANCATEGORY,
						t1.ONECATEGORY,
						t2.ORGCODEONE,
						t2.ORGNAMEONE,
						t3.ORGCODETWO,
						t3.ORGNAMETWO,
						t5.reportcnt,
						t6.end_
					FROM
						(
							SELECT
								flow_id,
								ORGCODEONE,
								ORGCODETWO,
								LOANCATEGORY,
								ONECATEGORY
							FROM
								T_GENERALPROCESS_MODELONE
						) t1
					JOIN (
						SELECT
							ORGCODE AS ORGCODEONE,
							ORGNAME AS ORGNAMEONE
						FROM
							OM_ORGANIZATION
					) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
					LEFT JOIN (
						SELECT
							ORGCODE AS ORGCODETWO,
							ORGNAME AS ORGNAMETWO
						FROM
							OM_ORGANIZATION
					) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
					JOIN (
						SELECT
							A .execution_ f_id
						FROM
							jbpm4_hist_actinst A
						WHERE
							A .transition_ LIKE '%结束%'
						AND A .execution_ IN (
							SELECT
								T .execution_
							FROM
								jbpm4_hist_actinst T
							WHERE
								T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						)
					) t4 ON t1.flow_id = t4.f_id
					JOIN (
						SELECT
							reportcnt,
							flow_id
						FROM
							T_GENERALPROCESS_MODELTHREE
					) t5 ON t1.flow_id = t5.flow_id
					JOIN (
						SELECT
							execution_,
							MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
						FROM
							jbpm4_hist_actinst T
						WHERE
							T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						AND execution_ IN (
							SELECT
								execution_
							FROM
								jbpm4_hist_actinst A
							WHERE
								A .transition_ LIKE '%结束%'
						)
						GROUP BY
							execution_
					) t6 ON t6.execution_ = t1.flow_id
				) ttn
		)
	WHERE
		reportcnt = '2'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
	GROUP BY
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
) tn1 ON tm.LOANCATEGORY = tn1.LOANCATEGORY
AND tm.ORGNAMEONE = tn1.ORGNAMEONE
AND tm.ONECATEGORY = tn1.ONECATEGORY
AND (
	tn1.ORGNAMETWO IS NOT NULL
	AND tm.ORGNAMETWO = tn1.ORGNAMETWO
)
LEFT JOIN (
	SELECT
		COUNT (*) n2,
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
	FROM
		(
			SELECT
				ttn.LOANCATEGORY,
				ttn.ORGCODEONE,
				ttn.ORGNAMEONE,
				ttn.ORGCODETWO,
				ttn.ORGNAMETWO,
				ttn.reportcnt,
				ttn.flow_id,
				ttn.end_,
				ttn.ONECATEGORY
			FROM
				(
					SELECT
						t1.flow_id,
						t1.LOANCATEGORY,
						t1.ONECATEGORY,
						t2.ORGCODEONE,
						t2.ORGNAMEONE,
						t3.ORGCODETWO,
						t3.ORGNAMETWO,
						t5.reportcnt,
						t6.end_
					FROM
						(
							SELECT
								flow_id,
								ORGCODEONE,
								ORGCODETWO,
								LOANCATEGORY,
								ONECATEGORY
							FROM
								T_GENERALPROCESS_MODELONE
						) t1
					JOIN (
						SELECT
							ORGCODE AS ORGCODEONE,
							ORGNAME AS ORGNAMEONE
						FROM
							OM_ORGANIZATION
					) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
					LEFT JOIN (
						SELECT
							ORGCODE AS ORGCODETWO,
							ORGNAME AS ORGNAMETWO
						FROM
							OM_ORGANIZATION
					) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
					JOIN (
						SELECT
							A .execution_ f_id
						FROM
							jbpm4_hist_actinst A
						WHERE
							A .transition_ LIKE '%结束%'
						AND A .execution_ IN (
							SELECT
								T .execution_
							FROM
								jbpm4_hist_actinst T
							WHERE
								T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						)
					) t4 ON t1.flow_id = t4.f_id
					JOIN (
						SELECT
							reportcnt,
							flow_id
						FROM
							T_GENERALPROCESS_MODELTHREE
					) t5 ON t1.flow_id = t5.flow_id
					JOIN (
						SELECT
							execution_,
							MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
						FROM
							jbpm4_hist_actinst T
						WHERE
							T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						AND execution_ IN (
							SELECT
								execution_
							FROM
								jbpm4_hist_actinst A
							WHERE
								A .transition_ LIKE '%结束%'
						)
						GROUP BY
							execution_
					) t6 ON t6.execution_ = t1.flow_id
				) ttn
		)
	WHERE
		reportcnt = '3'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
	GROUP BY
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
) tn2 ON tm.LOANCATEGORY = tn2.LOANCATEGORY
AND tm.ORGNAMEONE = tn2.ORGNAMEONE
AND tm.ONECATEGORY = tn2.ONECATEGORY
AND (
	tn2.ORGNAMETWO IS NOT NULL
	AND tm.ORGNAMETWO = tn2.ORGNAMETWO
)
LEFT JOIN (
	SELECT
		COUNT (*) n3,
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
	FROM
		(
			SELECT
				ttn.LOANCATEGORY,
				ttn.ORGCODEONE,
				ttn.ORGNAMEONE,
				ttn.ORGCODETWO,
				ttn.ORGNAMETWO,
				ttn.reportcnt,
				ttn.flow_id,
				ttn.end_,
				ttn.ONECATEGORY
			FROM
				(
					SELECT
						t1.flow_id,
						t1.LOANCATEGORY,
						t1.ONECATEGORY,
						t2.ORGCODEONE,
						t2.ORGNAMEONE,
						t3.ORGCODETWO,
						t3.ORGNAMETWO,
						t5.reportcnt,
						t6.end_
					FROM
						(
							SELECT
								flow_id,
								ORGCODEONE,
								ORGCODETWO,
								LOANCATEGORY,
								ONECATEGORY
							FROM
								T_GENERALPROCESS_MODELONE
						) t1
					JOIN (
						SELECT
							ORGCODE AS ORGCODEONE,
							ORGNAME AS ORGNAMEONE
						FROM
							OM_ORGANIZATION
					) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
					LEFT JOIN (
						SELECT
							ORGCODE AS ORGCODETWO,
							ORGNAME AS ORGNAMETWO
						FROM
							OM_ORGANIZATION
					) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
					JOIN (
						SELECT
							A .execution_ f_id
						FROM
							jbpm4_hist_actinst A
						WHERE
							A .transition_ LIKE '%结束%'
						AND A .execution_ IN (
							SELECT
								T .execution_
							FROM
								jbpm4_hist_actinst T
							WHERE
								T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						)
					) t4 ON t1.flow_id = t4.f_id
					JOIN (
						SELECT
							reportcnt,
							flow_id
						FROM
							T_GENERALPROCESS_MODELTHREE
					) t5 ON t1.flow_id = t5.flow_id
					JOIN (
						SELECT
							execution_,
							MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
						FROM
							jbpm4_hist_actinst T
						WHERE
							T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						AND execution_ IN (
							SELECT
								execution_
							FROM
								jbpm4_hist_actinst A
							WHERE
								A .transition_ LIKE '%结束%'
						)
						GROUP BY
							execution_
					) t6 ON t6.execution_ = t1.flow_id
				) ttn
		)
	WHERE
		reportcnt = '4'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
	GROUP BY
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
) tn3 ON tm.LOANCATEGORY = tn3.LOANCATEGORY
AND tm.ORGNAMEONE = tn3.ORGNAMEONE
AND tm.ONECATEGORY = tn3.ONECATEGORY
AND (
	tn3.ORGNAMETWO IS NOT NULL
	AND tm.ORGNAMETWO = tn3.ORGNAMETWO
)
LEFT JOIN (
	SELECT
		COUNT (*) n4,
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
	FROM
		(
			SELECT
				ttn.LOANCATEGORY,
				ttn.ORGCODEONE,
				ttn.ORGNAMEONE,
				ttn.ORGCODETWO,
				ttn.ORGNAMETWO,
				ttn.reportcnt,
				ttn.flow_id,
				ttn.end_,
				ttn.ONECATEGORY
			FROM
				(
					SELECT
						t1.flow_id,
						t1.LOANCATEGORY,
						t1.ONECATEGORY,
						t2.ORGCODEONE,
						t2.ORGNAMEONE,
						t3.ORGCODETWO,
						t3.ORGNAMETWO,
						t5.reportcnt,
						t6.end_
					FROM
						(
							SELECT
								flow_id,
								ORGCODEONE,
								ORGCODETWO,
								LOANCATEGORY,
								ONECATEGORY
							FROM
								T_GENERALPROCESS_MODELONE
						) t1
					JOIN (
						SELECT
							ORGCODE AS ORGCODEONE,
							ORGNAME AS ORGNAMEONE
						FROM
							OM_ORGANIZATION
					) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
					LEFT JOIN (
						SELECT
							ORGCODE AS ORGCODETWO,
							ORGNAME AS ORGNAMETWO
						FROM
							OM_ORGANIZATION
					) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
					JOIN (
						SELECT
							A .execution_ f_id
						FROM
							jbpm4_hist_actinst A
						WHERE
							A .transition_ LIKE '%结束%'
						AND A .execution_ IN (
							SELECT
								T .execution_
							FROM
								jbpm4_hist_actinst T
							WHERE
								T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						)
					) t4 ON t1.flow_id = t4.f_id
					JOIN (
						SELECT
							reportcnt,
							flow_id
						FROM
							T_GENERALPROCESS_MODELTHREE
					) t5 ON t1.flow_id = t5.flow_id
					JOIN (
						SELECT
							execution_,
							MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
						FROM
							jbpm4_hist_actinst T
						WHERE
							T .ACTIVITY_NAME_ LIKE '%发起合同预审'
						AND execution_ IN (
							SELECT
								execution_
							FROM
								jbpm4_hist_actinst A
							WHERE
								A .transition_ LIKE '%结束%'
						)
						GROUP BY
							execution_
					) t6 ON t6.execution_ = t1.flow_id
				) ttn
		)
	WHERE
		reportcnt = '5'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
	GROUP BY
		LOANCATEGORY,
		ORGCODEONE,
		ORGNAMEONE,
		ORGCODETWO,
		ORGNAMETWO,
		reportcnt,
		ONECATEGORY
) tn4 ON tm.LOANCATEGORY = tn4.LOANCATEGORY
AND tm.ORGNAMEONE = tn4.ORGNAMEONE
AND tm.ONECATEGORY = tn4.ONECATEGORY
AND (
	tn4.ORGNAMETWO IS NOT NULL
	AND tm.ORGNAMETWO = tn4.ORGNAMETWO
)
UNION
			SELECT
				tm.LOANCATEGORY,
				tm.ORGCODEONE,
				tm.ORGNAMEONE,
				tm.ORGCODETWO,
				tm.ORGNAMETWO,
				tm. M,
				tm.ONECATEGORY,
				tn1.n1  backOne,
				tn2.n2  backTwo,
				tn3.n3 backThree,
				tn4.n4 backFour
			FROM
				(
					SELECT
						COUNT (*) M,
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						ONECATEGORY
					FROM
						(
							SELECT
								t1.LOANCATEGORY,
								t1.ONECATEGORY,
								t2.ORGCODEONE,
								t2.ORGNAMEONE,
								t3.ORGCODETWO,
								t3.ORGNAMETWO,
								t5.end_
							FROM
								(
									SELECT
										flow_id,
										ORGCODEONE,
										ORGCODETWO,
										LOANCATEGORY,
										ONECATEGORY
									FROM
										T_GENERALPROCESS_MODELONE
								) t1
							JOIN (
								SELECT
									ORGCODE AS ORGCODEONE,
									ORGNAME AS ORGNAMEONE
								FROM
									OM_ORGANIZATION
							) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
							LEFT JOIN (
								SELECT
									ORGCODE AS ORGCODETWO,
									ORGNAME AS ORGNAMETWO
								FROM
									OM_ORGANIZATION
							) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
							JOIN (
								SELECT
									A .execution_ f_id
								FROM
									jbpm4_hist_actinst A
								WHERE
									A .transition_ LIKE '%结束%'
								AND A .execution_ IN (
									SELECT
										T .execution_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
								)
							) t4 ON t1.flow_id = t4.f_id
							JOIN (
								SELECT
									execution_,
									MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
								FROM
									jbpm4_hist_actinst T
								WHERE
									T .ACTIVITY_NAME_ LIKE '%发起合同预审'
								AND execution_ IN (
									SELECT
										execution_
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_ LIKE '%结束%'
								)
								GROUP BY
									execution_
							) t5 ON t1.flow_id = t5.execution_
						)
					WHERE
						ORGNAMETWO IS NULL
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
					GROUP BY
						LOANCATEGORY,
						ORGCODEONE,
						ORGNAMEONE,
						ORGCODETWO,
						ORGNAMETWO,
						ONECATEGORY
				) tm
			LEFT JOIN (
				SELECT
					COUNT (*) n1,
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
				FROM
					(
						SELECT
							ttn.LOANCATEGORY,
							ttn.ORGCODEONE,
							ttn.ORGNAMEONE,
							ttn.ORGCODETWO,
							ttn.ORGNAMETWO,
							ttn.reportcnt,
							ttn.flow_id,
							ttn.end_,
							ttn.ONECATEGORY
						FROM
							(
								SELECT
									t1.flow_id,
									t1.LOANCATEGORY,
									t1.ONECATEGORY,
									t2.ORGCODEONE,
									t2.ORGNAMEONE,
									t3.ORGCODETWO,
									t3.ORGNAMETWO,
									t5.reportcnt,
									t6.end_
								FROM
									(
										SELECT
											flow_id,
											ORGCODEONE,
											ORGCODETWO,
											LOANCATEGORY,
											ONECATEGORY
										FROM
											T_GENERALPROCESS_MODELONE
									) t1
								JOIN (
									SELECT
										ORGCODE AS ORGCODEONE,
										ORGNAME AS ORGNAMEONE
									FROM
										OM_ORGANIZATION
								) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
								LEFT JOIN (
									SELECT
										ORGCODE AS ORGCODETWO,
										ORGNAME AS ORGNAMETWO
									FROM
										OM_ORGANIZATION
								) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
								JOIN (
									SELECT
										A .execution_ f_id
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_ LIKE '%结束%'
									AND A .execution_ IN (
										SELECT
											T .execution_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									)
								) t4 ON t1.flow_id = t4.f_id
								JOIN (
									SELECT
										reportcnt,
										flow_id
									FROM
										T_GENERALPROCESS_MODELTHREE
								) t5 ON t1.flow_id = t5.flow_id
								JOIN (
									SELECT
										execution_,
										MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									AND execution_ IN (
										SELECT
											execution_
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ LIKE '%结束%'
									)
									GROUP BY
										execution_
								) t6 ON t6.execution_ = t1.flow_id
							) ttn
					)
				WHERE
					reportcnt = '2'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
				GROUP BY
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
			) tn1 ON tm.LOANCATEGORY = tn1.LOANCATEGORY
			AND tm.ORGNAMEONE = tn1.ORGNAMEONE
			AND tm.ONECATEGORY = tn1.ONECATEGORY
			AND tn1.ORGNAMETWO IS NULL
			LEFT JOIN (
				SELECT
					COUNT (*) n2,
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
				FROM
					(
						SELECT
							ttn.LOANCATEGORY,
							ttn.ORGCODEONE,
							ttn.ORGNAMEONE,
							ttn.ORGCODETWO,
							ttn.ORGNAMETWO,
							ttn.reportcnt,
							ttn.flow_id,
							ttn.end_,
							ttn.ONECATEGORY
						FROM
							(
								SELECT
									t1.flow_id,
									t1.LOANCATEGORY,
									t1.ONECATEGORY,
									t2.ORGCODEONE,
									t2.ORGNAMEONE,
									t3.ORGCODETWO,
									t3.ORGNAMETWO,
									t5.reportcnt,
									t6.end_
								FROM
									(
										SELECT
											flow_id,
											ORGCODEONE,
											ORGCODETWO,
											LOANCATEGORY,
											ONECATEGORY
										FROM
											T_GENERALPROCESS_MODELONE
									) t1
								JOIN (
									SELECT
										ORGCODE AS ORGCODEONE,
										ORGNAME AS ORGNAMEONE
									FROM
										OM_ORGANIZATION
								) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
								LEFT JOIN (
									SELECT
										ORGCODE AS ORGCODETWO,
										ORGNAME AS ORGNAMETWO
									FROM
										OM_ORGANIZATION
								) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
								JOIN (
									SELECT
										A .execution_ f_id
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_ LIKE '%结束%'
									AND A .execution_ IN (
										SELECT
											T .execution_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									)
								) t4 ON t1.flow_id = t4.f_id
								JOIN (
									SELECT
										reportcnt,
										flow_id
									FROM
										T_GENERALPROCESS_MODELTHREE
								) t5 ON t1.flow_id = t5.flow_id
								JOIN (
									SELECT
										execution_,
										MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									AND execution_ IN (
										SELECT
											execution_
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ LIKE '%结束%'
									)
									GROUP BY
										execution_
								) t6 ON t6.execution_ = t1.flow_id
							) ttn
					)
				WHERE
					reportcnt = '3'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
				GROUP BY
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
			) tn2 ON tm.LOANCATEGORY = tn2.LOANCATEGORY
			AND tm.ORGNAMEONE = tn2.ORGNAMEONE
			AND tm.ONECATEGORY = tn2.ONECATEGORY
			AND tn2.ORGNAMETWO IS NULL
			LEFT JOIN (
				SELECT
					COUNT (*) n3,
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
				FROM
					(
						SELECT
							ttn.LOANCATEGORY,
							ttn.ORGCODEONE,
							ttn.ORGNAMEONE,
							ttn.ORGCODETWO,
							ttn.ORGNAMETWO,
							ttn.reportcnt,
							ttn.flow_id,
							ttn.end_,
							ttn.ONECATEGORY
						FROM
							(
								SELECT
									t1.flow_id,
									t1.LOANCATEGORY,
									t1.ONECATEGORY,
									t2.ORGCODEONE,
									t2.ORGNAMEONE,
									t3.ORGCODETWO,
									t3.ORGNAMETWO,
									t5.reportcnt,
									t6.end_
								FROM
									(
										SELECT
											flow_id,
											ORGCODEONE,
											ORGCODETWO,
											LOANCATEGORY,
											ONECATEGORY
										FROM
											T_GENERALPROCESS_MODELONE
									) t1
								JOIN (
									SELECT
										ORGCODE AS ORGCODEONE,
										ORGNAME AS ORGNAMEONE
									FROM
										OM_ORGANIZATION
								) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
								LEFT JOIN (
									SELECT
										ORGCODE AS ORGCODETWO,
										ORGNAME AS ORGNAMETWO
									FROM
										OM_ORGANIZATION
								) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
								JOIN (
									SELECT
										A .execution_ f_id
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_ LIKE '%结束%'
									AND A .execution_ IN (
										SELECT
											T .execution_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									)
								) t4 ON t1.flow_id = t4.f_id
								JOIN (
									SELECT
										reportcnt,
										flow_id
									FROM
										T_GENERALPROCESS_MODELTHREE
								) t5 ON t1.flow_id = t5.flow_id
								JOIN (
									SELECT
										execution_,
										MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									AND execution_ IN (
										SELECT
											execution_
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ LIKE '%结束%'
									)
									GROUP BY
										execution_
								) t6 ON t6.execution_ = t1.flow_id
							) ttn
					)
				WHERE
					reportcnt = '4'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
				GROUP BY
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
			) tn3 ON tm.LOANCATEGORY = tn3.LOANCATEGORY
			AND tm.ORGNAMEONE = tn3.ORGNAMEONE
			AND tm.ONECATEGORY = tn3.ONECATEGORY
			AND tn3.ORGNAMETWO IS NULL
			LEFT JOIN (
				SELECT
					COUNT (*) n4,
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
				FROM
					(
						SELECT
							ttn.LOANCATEGORY,
							ttn.ORGCODEONE,
							ttn.ORGNAMEONE,
							ttn.ORGCODETWO,
							ttn.ORGNAMETWO,
							ttn.reportcnt,
							ttn.flow_id,
							ttn.end_,
							ttn.ONECATEGORY
						FROM
							(
								SELECT
									t1.flow_id,
									t1.LOANCATEGORY,
									t1.ONECATEGORY,
									t2.ORGCODEONE,
									t2.ORGNAMEONE,
									t3.ORGCODETWO,
									t3.ORGNAMETWO,
									t5.reportcnt,
									t6.end_
								FROM
									(
										SELECT
											flow_id,
											ORGCODEONE,
											ORGCODETWO,
											LOANCATEGORY,
											ONECATEGORY
										FROM
											T_GENERALPROCESS_MODELONE
									) t1
								JOIN (
									SELECT
										ORGCODE AS ORGCODEONE,
										ORGNAME AS ORGNAMEONE
									FROM
										OM_ORGANIZATION
								) t2 ON t1.ORGCODEONE = t2.ORGCODEONE
								LEFT JOIN (
									SELECT
										ORGCODE AS ORGCODETWO,
										ORGNAME AS ORGNAMETWO
									FROM
										OM_ORGANIZATION
								) t3 ON t1.ORGCODETWO = t3.ORGCODETWO
								JOIN (
									SELECT
										A .execution_ f_id
									FROM
										jbpm4_hist_actinst A
									WHERE
										A .transition_ LIKE '%结束%'
									AND A .execution_ IN (
										SELECT
											T .execution_
										FROM
											jbpm4_hist_actinst T
										WHERE
											T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									)
								) t4 ON t1.flow_id = t4.f_id
								JOIN (
									SELECT
										reportcnt,
										flow_id
									FROM
										T_GENERALPROCESS_MODELTHREE
								) t5 ON t1.flow_id = t5.flow_id
								JOIN (
									SELECT
										execution_,
										MAX (TO_CHAR(end_, 'yyyy-mm-dd')) end_
									FROM
										jbpm4_hist_actinst T
									WHERE
										T .ACTIVITY_NAME_ LIKE '%发起合同预审'
									AND execution_ IN (
										SELECT
											execution_
										FROM
											jbpm4_hist_actinst A
										WHERE
											A .transition_ LIKE '%结束%'
									)
									GROUP BY
										execution_
								) t6 ON t6.execution_ = t1.flow_id
							) ttn
					)
				WHERE
					reportcnt = '5'
		<isNotNull prepend="and" property="appTimeStrat" >
                  end_  >=(#appTimeStrat#)
        </isNotNull>
       <isNotNull prepend="and" property="appTimeEnd" >                                    
                <![CDATA[end_  <=(#appTimeEnd#)]]>
      </isNotNull>
      <isNotNull prepend="and" property="oneCategory" >
                 ONECATEGORY  in($oneCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="loanCategory" >
                 LOANCATEGORY in($loanCategory$)
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeOne" >
                 ORGCODEONE = '$orgCodeOne$'
      </isNotNull>
      <isNotNull prepend="and" property="orgCodeTwo" >
                 ORGCODETWO = '$orgCodeTwo$'
      </isNotNull>
				GROUP BY
					LOANCATEGORY,
					ORGCODEONE,
					ORGNAMEONE,
					ORGCODETWO,
					ORGNAMETWO,
					reportcnt,
					ONECATEGORY
			) tn4 ON tm.LOANCATEGORY = tn4.LOANCATEGORY
			AND tm.ORGNAMEONE = tn4.ORGNAMEONE
			AND tm.ONECATEGORY = tn4.ONECATEGORY
			AND tn4.ORGNAMETWO IS NULL
)
)
)
	</select>
</sqlMap>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="T_ERRORSTATISTIC_SqlMap">
 <resultMap id="ErrorStatistic" class="com.gotop.reportjbpm.model.ErrorStatistic" >
    <!--Bean方式返回全表-->
    <result column="NEXT_ORG_NAME" property="nextOrgName" jdbcType="VARCHAR" />
    <result column="NEXT_OPR_NAME" property="nextOprName" jdbcType="VARCHAR" />
    <result column="LOANCATEGORY" property="loancategory" jdbcType="VARCHAR" />
    <result column="FDXDY" property="fdxdy" jdbcType="VARCHAR" />
    <result column="YXZG" property="yxzg" jdbcType="VARCHAR" />
    <result column="MISTAKE_CONTENT" property="mistakeContent" jdbcType="VARCHAR" />
    <result column="PUNISH_BAL" property="punishBal" jdbcType="VARCHAR" />
    <result column="TASKNAME" property="taskName" jdbcType="VARCHAR" />
    <result column="REPORTTIME" property="reportTime" jdbcType="VARCHAR" />
    <result column="CUST_NAME" property="custName" jdbcType="VARCHAR" />
    <result column="EMPNAME" property="empName" jdbcType="VARCHAR" />
    <result column="ADD_TIME" property="addTime" jdbcType="VARCHAR" />
  </resultMap>
   <resultMap id="ErrorStatistic1" class="com.gotop.reportjbpm.model.ErrorStatistic" >
    <!--Bean方式返回全表-->
    <result column="TASKNAME" property="taskName" jdbcType="VARCHAR" />
  </resultMap>
  
  	<select id="querytaskNameList" parameterClass="java.util.HashMap" resultMap="ErrorStatistic1">
	select distinct taskname from T_GENERALPROCESS_MODELFOUR
	</select>
	
	<!-- 查询差错情况统计 -->
	<select id="queryErrorStatistic" parameterClass="java.util.HashMap" resultMap="ErrorStatistic">
	SELECT *
  FROM (select G.ORGNAME AS NEXT_ORG_NAME,
               E.Flow_Id,
               E.LOANCATEGORY,
               E.FDXDY,
               E.YXZG,
               T.MISTAKE_CONTENT,
               T.PUNISH_BAL,
               T.TASKNAME,
               M.REPORTTIME,
               E.CUST_NAME,
               P.EMPNAME,
               T.ADD_TIME
          FROM T_GENERALPROCESS_MODELONE   E,
               T_GENERALPROCESS_MISTAKE    T,
               T_GENERALPROCESS_MODELTHREE M,
               OM_ORGANIZATION             G,
               OM_EMPLOYEE                 P
         where e.flow_id = t.flow_id
           and t.flow_id = m.flow_id
           and p.empid = t.empid
           AND E.ORGCODEONE = G.ORGCODE) A1
  LEFT JOIN (select P.EMPNAME as NEXT_OPR_NAME, E.FLOW_ID
               FROM OM_EMPLOYEE P, T_GENERALPROCESS_MODELONE E
              where E.CREATOR = P.EMPID) A2
    on A1.FLOW_ID = A2.FLOW_ID where 1=1
   
      <isNotNull prepend="and" property="custName" >
        A1.CUST_NAME   like '%$custName$%'
      </isNotNull>
      
      <isNotNull prepend="and" property="taskName" >
        A1.TASKNAME in($taskName$)
      </isNotNull>
      
      <isNotNull prepend="and" property="startTime" >
        <![CDATA[A1.REPORTTIME>=#startTime#]]>
      </isNotNull>
      
      <isNotNull prepend="and" property="endTime" >
       <![CDATA[A1.REPORTTIME<=#endTime#]]>
      </isNotNull>
     
	</select>

</sqlMap>
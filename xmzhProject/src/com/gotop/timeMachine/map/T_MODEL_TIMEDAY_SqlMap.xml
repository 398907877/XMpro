<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="T_MODEL_TIMEDAY_SqlMap" >
  <resultMap id="workDay_Result" class="com.gotop.timeMachine.model.TModelTimeday" >
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="TIME" property="time" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
     <result column="MAINID" property="mainID" jdbcType="DECIMAL" />
     <result column="TYPE" property="type" jdbcType="VARCHAR" />
    <result column="ORGNAME" property="orgname" jdbcType="VARCHAR" />
    <result column="EMPNAME" property="empname" jdbcType="VARCHAR" />
     <result column="STARTDATE" property="startDate" jdbcType="VARCHAR" />
    <result column="ENDDATE" property="endDate" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="workDay_Result2" class="com.gotop.timeMachine.model.TModelTimeday" >
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="TIME" property="time" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
     <result column="MAINID" property="mainID" jdbcType="DECIMAL" />
     <result column="TYPE" property="type" jdbcType="VARCHAR" />
    <result column="ORGCODE" property="orgcode" jdbcType="VARCHAR" />
    <result column="EMPID" property="empid" jdbcType="VARCHAR" />
     <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 查询工作日列表  T_MODEL_TIMEDAY-->
  <select id="queryWorkDayListWithPage" resultMap="workDay_Result" parameterClass="com.gotop.timeMachine.model.TModelTimeday" >
    select t1.ID, t1.TIME,  t1.STATUS,t1.MAINID,t1.TYPE, t2.ORGNAME, t3.EMPNAME, to_char(t4.startDate, 'yyyy/MM/dd') as startDate , to_char(t4.endDate, 'yyyy/MM/dd') as endDate
    from T_MODEL_TIMEDAY t1, om_organization t2, om_employee t3, t_model_timeMain t4
    where t1.orgcode = t2.orgcode
	 and t1.empid = t3.empid
	 and t1.mainID = t4.id
	 and t1.mainID = #mainID:DECIMAL:-9999#
	 order by t1.time
  </select>
  
  <!-- 校验 非工作日是否已存在 -->
  <select id="checkDayTime" resultMap="workDay_Result2" parameterClass="com.gotop.timeMachine.model.TModelTimeday" >
    select t1.*
    from T_MODEL_TIMEDAY t1
    where  t1.time = #time:VARCHAR#
  </select>
  
  <!-- 插入 一条 非工作日记录 -->
  <insert id="insertWorkDay"  parameterClass="com.gotop.timeMachine.model.TModelTimeday"  >
       <selectKey resultClass="long" keyProperty="id" >
		SELECT SEQ_T_MODEL_TIMEDAY.NEXTVAL AS VALUE FROM DUAL
		</selectKey>
    insert into T_MODEL_TIMEDAY(ID, TYPE, TIME, STATUS, MAINID, REMARK, ORGCODE, EMPID )
    values (#id:DECIMAL:-9999#, #type:VARCHAR#, trim(#time:VARCHAR#), #status:VARCHAR#, #mainID:DECIMAL#, #remark:VARCHAR#, #orgcode:VARCHAR#, #empid:VARCHAR#)
  </insert>
  
  <!-- 修改 非工作日  -->
  <update id="updateWorkDayById" parameterClass="com.gotop.timeMachine.model.TModelTimeday" >
    update T_MODEL_TIMEDAY t
    set t.type = #type:VARCHAR#,
    	t.time = #time:VARCHAR#,
    	t.remark = #remark:VARCHAR#,
    	t.status = #status:VARCHAR#,
    	t.orgcode = #orgcode:VARCHAR#,
    	t.empid = #empid:VARCHAR#
    where t.id = #id:DECIMAL:-9999# 
  </update>
  
  <!-- 删除 非工作日 记录 -->
  <delete id="delWorkDayById" parameterClass="com.gotop.timeMachine.model.TModelTimeday" >
    delete from T_MODEL_TIMEDAY t
    where t.id = #id:DECIMAL:-9999# 
  </delete>
  
  <select id="queryWorkDayById" resultMap="workDay_Result2" parameterClass="com.gotop.timeMachine.model.TModelTimeday" >
    select t1.ID, t1.TYPE, to_char( to_date(t1.TIME, 'yyyy/MM/dd') ,'yyyy-MM-dd' ) as time, t1.REMARK, t1.STATUS, t1.MAINID, t1.ORGCODE, t1.EMPID
    from T_MODEL_TIMEDAY t1
    where t1.id = #id:DECIMAL:-9999#
  </select>
  
</sqlMap>
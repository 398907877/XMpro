<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="XD_PROCESS_SqlMap" >
 <resultMap id="abatorgenerated_XdProcess_HashMapResult" class="java.util.HashMap" >
    <!--HashMap方式返回全表-->
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="EXECUTION_ID" property="executionId" jdbcType="VARCHAR" />
    <result column="assignee" property="assignee" jdbcType="VARCHAR" />
    <result column="TASK_ID" property="taskId" jdbcType="VARCHAR" />
    <result column="PRE_TASK_ID" property="preTaskId" jdbcType="VARCHAR" />
    <result column="PRE_TASK_ASSINGEE" property="preTaskAssingee" jdbcType="DECIMAL" />
    <result column="PRE_TASK_ORG" property="preTaskOrg" jdbcType="DECIMAL" />
    <result column="PRE_TASK_TIME" property="preTaskTime" jdbcType="VARCHAR" />
    <result column="NEXT_TASK_ID" property="nextTaskId" jdbcType="VARCHAR" />
    <result column="BUSINESS_KEY" property="businessKey" jdbcType="DECIMAL" />
    <result column="BUSINESS_TYPE" property="businessType" jdbcType="VARCHAR" />
    <result column="preTaskOrgName" property="preTaskOrgName" jdbcType="VARCHAR" />
     <result column="preTaskAssingeeName" property="preTaskAssingeeName" jdbcType="VARCHAR" />
     <result column="processName" property="processName" jdbcType="VARCHAR" />
     <result column="BUSINESS_TITLE" property="businessTitle" jdbcType="VARCHAR" />
     <result column="PROCESS_TASK_ASSIGNEE_ID" property="processTaskAssigneeId" jdbcType="DECIMAL" />
     <result column="PARENT_ID" property="parentId" jdbcType="DECIMAL" />
     <result column="ISCHILD" property="isChild" jdbcType="VARCHAR" />
     <result column="BUSINESS_NAME" property="businessName" jdbcType="VARCHAR" />
     <result column="CUST_NAME" property="custName" jdbcType="VARCHAR" />
     <result column="ONECATEGORY" property="oneCategory" jdbcType="VARCHAR" />
     <result column="LOANCATEGORY" property="loanCategory" jdbcType="VARCHAR" />
     <result column="REPORTCNT" property="reportCnt" jdbcType="VARCHAR" />
     <result column="REPORTTIME" property="reportTime" jdbcType="VARCHAR" />
          
  </resultMap>
  
 <resultMap id="abatorgenerated_XdProcess_HashMapResult2" class="java.util.HashMap" >
    <!--HashMap方式返回全表-->
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="DEFINITION_ID" property="definitionId" jdbcType="VARCHAR" />
    <result column="PROCESS_NAME" property="processName" jdbcType="VARCHAR" />
    <result column="BUSINESS_TYPE" property="businessType" jdbcType="VARCHAR" />
    <result column="STATE" property="state" jdbcType="VARCHAR" />
    <result column="UPLOAD_TIME" property="uploadTime" jdbcType="VARCHAR" />
 </resultMap>
  
  <!--查询信贷流程 待办事项列表-->
  <select id="queryXdMyTodoList" resultMap="abatorgenerated_XdProcess_HashMapResult" parameterClass="java.util.HashMap" >
  select T13.* from
   (select T11.*, T12.REPORTCNT, T12.REPORTTIME
  from (select T9.*, T10.CUST_NAME, T10.ONECATEGORY, T10.LOANCATEGORY
          from (SELECT T1.ID,
                       T7.EXECUTION_ID_ as EXECUTION_ID,
                       t2.task_assignee_id as assignee,
                       T1.TASK_ID,
                       T1.PRE_TASK_ID,
                       T1.PRE_TASK_ASSINGEE,
                       T1.PRE_TASK_ORG,
                       to_char(TO_DATE(T1.PRE_TASK_TIME,
                                       'yyyy/MM/dd hh24:mi:ss'),
                               'yyyy-mm-dd hh24:mi:ss') AS PRE_TASK_TIME,
                       T1.NEXT_TASK_ID,
                       T1.BUSINESS_KEY,
                       T3.EMPNAME AS preTaskAssingeeName,
                       T4.ORGNAME AS preTaskOrgName,
                       T6.PROCESS_NAME AS processName,
                       T6.BUSINESS_TYPE AS BUSINESS_TYPE,
                       T2.PROCESS_TASK_ASSIGNEE_ID,
                       T2.PARENT_ID,
                       T2.ISCHILD,
                       T8.business_title as BUSINESS_TITLE,
                       a.dictname AS BUSINESS_NAME
                  FROM T_PROCESS_TASK_ASSIGNEE        T1,
                       T_PROCESS_TASK_ASSIGNEE_PERSON T2,
                       OM_EMPLOYEE                    T3,
                       OM_ORGANIZATION                T4,
                       JBPM4_EXECUTION                T5,
                       T_PROCESS_CONFIG               T6,
                       JBPM4_TASK                     T7,
                       T_PROCESS_BUSINESS             T8,
                       eos_dict_entry                 a,
                       eos_dict_type                  b
                 where T1.ID = T2.PROCESS_TASK_ASSIGNEE_ID
                   AND T1.PRE_TASK_ASSINGEE = T3.EMPID
                   AND T1.PRE_TASK_ORG = T4.ORGID
                   AND T5.PROCDEFID_ = T6.DEFINITION_ID
                   AND T5.ID_ = T7.EXECUTION_ID_
                   AND T2.TASK_ID = T7.DBID_
                   AND T7.STATE_ = 'open'
                   AND T1.EXECUTION_ID = T8.EXECUTION_ID
                   AND T1.Business_Type = a.dictid
                   AND a.dicttypeid = b.dicttypeid
                   AND b.dicttypeid = 'ZHPT_BUSINESS_TYPE'
                   AND T2.TASK_ASSIGNEE_ID IN
                       ('1',
                        '35008816',
                        'SENIORADM',
                        'COMMONUSER',
                        'SYSADMIN',
                        'DATAADM',
                        'DEVICEADM',
                        'SENIORADM',
                        'COMMONUSER',
                        'SYSADMIN',
                        'DATAADM',
                        'DEVICEADM')
                   and T8.business_type = '88') T9
          left join T_GENERALPROCESS_MODELONE T10
            on T9.EXECUTION_ID = T10.FLOW_ID) T11
  left join T_GENERALPROCESS_MODELTHREE T12
    on T11.EXECUTION_ID = T12.FLOW_ID ) T13
    <dynamic prepend="where" >
   <isNotNull prepend="and" property="custName" >
           T13.CUST_NAME like '%'||'$custName$'||'%'
      		</isNotNull>
      		<isNotNull prepend="and" property="oneCategoryId" >
           	T13.oneCategory in(select dic.dictname from eos_dict_entry dic where dic.dicttypeid='PROCESS_onecategory' 
           	 and dic.dictid in($oneCategoryId$))
      		</isNotNull>
      		 <isNotNull prepend="and" property="loanCategoryId" >
           	 T13.loanCategory in(select dic.dictname from eos_dict_entry dic where dic.dicttypeid='PROCESS_credit_type' 
           	 and dic.dictid in($loanCategoryId$))
      		</isNotNull>
      		</dynamic>
      		order by T13.REPORTCNT desc, T13.REPORTTIME asc
  </select>
  
   <select id="queryXdProcessList" resultMap="abatorgenerated_XdProcess_HashMapResult2" parameterClass="java.util.HashMap" >
   select t.ID,
       t.DEFINITION_ID,
       t.PROCESS_NAME,
       t.BUSINESS_TYPE,
       t.STATE,
       t.UPLOAD_TIME
  from T_PROCESS_CONFIG t
 where t.BUSINESS_TYPE = 88
 <isNotNull prepend="and" property="processName" >
  t.PROCESS_NAME like '%'||'$processName$'||'%'
 </isNotNull>
  order by t.ORDER_NO ASC
   </select>
</sqlMap>
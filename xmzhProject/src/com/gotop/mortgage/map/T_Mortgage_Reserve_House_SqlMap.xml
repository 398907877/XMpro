<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="T_Mortgage_Reserve_House_SqlMap">
	<resultMap class="com.gotop.mortgage.model.MortgageReserveHouseCar" id="mortgageReserveHouseCar">
		<result column="WARRANTS_ID" property="warrantsId" jdbcType="VARCHAR"/>
     	<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR" />
     	<result column="LOAN_TYPE" property="loanType" jdbcType="VARCHAR" />
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR" />
     	<result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
     	<result column="STATUS" property="status" jdbcType="VARCHAR" />
     	<result column="OTHER_TYPE" property="otherType" jdbcType="VARCHAR" />
     	<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR" />
     </resultMap>
     
     <resultMap class="com.gotop.mortgage.model.MortgageReserveHouseCar" id="mortgageReserveHouseCar2">
		<!-- <result column="WARRANTS_ID" property="warrantsId" jdbcType="VARCHAR"/>
     	<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR" />
     	<result column="LOAN_TYPE" property="loanType" jdbcType="VARCHAR" />
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR" />
     	<result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
     	<result column="STATUS" property="status" jdbcType="VARCHAR" />
     	<result column="OTHER_TYPE" property="otherType" jdbcType="VARCHAR" />
     	<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR" />
     	 -->
     	<result column="WARRANTS_ID" property="warrantsId" jdbcType="VARCHAR"/>
     	<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR" />
     	<result column="OTHERWARRANTSNUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR" />
     	<result column="LOAN_TYPE" property="loanType" jdbcType="VARCHAR" />	
     	<result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
     	
     	<result column="BORROWER_CONTRACTNO" property="borrowerContractno" jdbcType="VARCHAR" />
     	<result column="PROPERTY_NAME" property="propertyName" jdbcType="VARCHAR" />
     	<result column="PROPERTY_NO" property="propertyNo" jdbcType="VARCHAR" />
     </resultMap>
     <resultMap class="com.gotop.mortgage.model.MortgageReserveHouseCar" id="mortgageReserveHouseCar3">
     	<result column="WARRANTS_ID" property="warrantsId" jdbcType="VARCHAR"/>
     	<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR" />
     	<result column="OTHERWARRANTSNUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR" />
     	<result column="LOAN_TYPE" property="loanType" jdbcType="VARCHAR" />	
     	<result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
     	<result column="BORROWER_CARDNO" property="borrowerCardNo" jdbcType="VARCHAR" />	
     	<result column="BORROWER_CONTRACTNO" property="borrowerContractno" jdbcType="VARCHAR" />
     	<result column="PROPERTY_NAME" property="propertyName" jdbcType="VARCHAR" />
     	<result column="PROPERTY_NO" property="propertyNo" jdbcType="VARCHAR" />
     	<result column="INSERT_TIME" property="insertTime" jdbcType="VARCHAR" />
     	
     </resultMap>
     
     <resultMap id="mortgageReserve" class="com.gotop.mortgage.model.MortgageReserve" >
    <!--Bean方式返回全表-->
    	<result column="ID" property="id" jdbcType="VARCHAR"/>
  		<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR"/>
  </resultMap>
  <!-- 房产非外借bean -->
  <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList2">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="PROPERTY_NO" property="propertyNo" jdbcType="VARCHAR"/>
     	<result column="PROPERTY_NAME" property="propertyName" jdbcType="VARCHAR"/>
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="BORROWER_NUMS" property="borrowerNums" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
     	<result column="HOUSE_WARRANTS_NUMS" property="propertyNums" jdbcType="VARCHAR"/>
     	<result column="OTHER_WARRANTS_NUMS" property="otherWarrantsNums" jdbcType="VARCHAR"/>
  		
  </resultMap>
  <!-- 机动车非外借Bean -->
  <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList4">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="CAR_NO" property="carNo" jdbcType="VARCHAR"/>
     	<result column="CAR_NAME" property="carName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="BORROWER_NUMS" property="borrowerNums" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
  		<result column="HOUSE_WARRANTS_NUMS" property="propertyNums" jdbcType="VARCHAR"/>
     	<result column="OTHER_WARRANTS_NUMS" property="otherWarrantsNums" jdbcType="VARCHAR"/>
  </resultMap>  
     <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList1">
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
     	<result column="PROPERTY_NUMS" property="propertyNums" jdbcType="VARCHAR"/>
     	<result column="alls" property="alls" jdbcType="VARCHAR"/>
     	
     	<result column="OTHERWARRANTS_NUMS" property="otherWarrantsNums" jdbcType="VARCHAR"/>
     	
     </resultMap>
     <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList3">
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
     	<result column="alls" property="alls" jdbcType="VARCHAR"/>
     	<result column="cars" property="cars" jdbcType="VARCHAR"/>
     	<result column="others" property="others" jdbcType="VARCHAR"/>
     </resultMap>
     
     
     <select id="queryMortgageReserveHouseList" parameterClass="java.util.HashMap" resultMap="mortgageReserveHouseCar3">
  select t.id as WARRANTS_ID,
        MAX(t.no_register_sign) as no_Register_Sign,
       MAX(t.loan_type) as LOAN_TYPE,
       MAX(t.other_warrants_number) OTHERWARRANTSNUMBER,
       MAX(t.borrower_name) as BORROWER_NAME,
        MAX(t.BORROWER_CARDNO) as BORROWER_CARDNO,
       MAX(t.BORROWER_CONTRACTNO) as BORROWER_CONTRACTNO,   
       wm_concat(to_char(o.PROPERTY_NAME)) as PROPERTY_NAME,
       wm_concat(to_char(o.PROPERTY_NO)) as PROPERTY_NO,
       to_char(TO_DATE(MAX(t.INSERT_TIME), 'yyyyMMddhh24miss'),
                                'yyyy-mm-dd') as INSERT_TIME
  from t_warrants_info t left join t_mortgage_house_info o 
  on t.id=o.warrants_id
 where  t.mortgage_type='1' and t.status = '1'
  
 <isNotNull prepend="and" property="propertyName" >
         <![CDATA[
           o.property_name like '%$propertyName$%'
               ]]>
      </isNotNull>
      <isNotNull prepend="and" property="propertyCardNo" >
         <![CDATA[
            o.property_cardno like '%$propertyCardNo$%'
               ]]>
      </isNotNull>
      <isNotNull prepend="and" property="propertyNo" >
         <![CDATA[
            o.PROPERTY_NO like '%$propertyNo$%'
               ]]>
      </isNotNull>
      <isNotNull prepend="and" property="propertyAddres" >
         <![CDATA[
            o.property_addres like '%$propertyAddres$%'
               ]]>
      </isNotNull>
      <isNotNull prepend="and" property="noRegisterSign" >
         <![CDATA[
             t.NO_REGISTER_SIGN = '$noRegisterSign$'
               ]]>
      </isNotNull>
      <isNotNull prepend="and" property="parentorgid">
			t.ORG_CODE in (select orgcode
			  from om_organization o
			 start with orgid = '$parentorgid$'
			connect by prior orgid = parentorgid)
      </isNotNull>
      group by t.id
      order by INSERT_TIME desc
  </select>  
   <select id="queryPropertyNameAndNoList" parameterClass="java.util.HashMap" resultMap="mortgageReserveHouseCar2">
  select t.id as WARRANTS_ID,
        t.no_register_sign as no_Register_Sign,
       t.loan_type as LOAN_TYPE,
       t.other_warrants_number OTHERWARRANTSNUMBER,
       t.borrower_name || ' : ' || t.BORROWER_CARDNO as BORROWER_NAME,
       t.BORROWER_CONTRACTNO as BORROWER_CONTRACTNO,    
       o.PROPERTY_NAME as PROPERTY_NAME,
       o.PROPERTY_NO as PROPERTY_NO
  from t_warrants_info t left join t_mortgage_house_info o 
  on t.id=o.warrants_id
 where  t.mortgage_type='1'
      <isNotNull prepend="and" property="warrantsId" >
         <![CDATA[
             WARRANTS_ID = '$warrantsId$'
               ]]>
      </isNotNull>
  </select>  
  <select id="queryMortgageReserveById" parameterClass="java.util.HashMap" resultMap="mortgageReserve">
  	select a.id as id,a.no_register_sign as NO_REGISTER_SIGN from T_WARRANTS_INFO a 
  	 where a.id='$id$'
  </select>
  <update id="noRegisterSignUpdate" parameterClass="java.util.HashMap">
  update T_WARRANTS_INFO a set 
        NO_REGISTER_SIGN = '$noRegisterSign$'
  where a.ID='$id$'
  </update>
     
<select id="queryMortgageQueryForExcel" parameterClass="java.util.HashMap" resultMap="mortgageReserveHouseCar">
	select t.id as WARRANTS_ID,
       t.no_register_sign as no_Register_Sign,
       t.other_type as OTHER_TYPE,
       t.project_number as PROJECT_NUMBER,
       t.loan_type as LOAN_TYPE,
       t.other_warrants_number as OTHER_WARRANTS_NUMBER,
       t.borrower_name as BORROWER_NAME,
       t.status as status
       from t_warrants_info t
       where 1=1

		<dynamic>  
       <isNotEmpty prepend=" and" property="propertyName">
         t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_name like '%$propertyName$%'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyCardNo">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_cardno='$propertyCardNo$'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyNo">
        t.id in(select h.warrants_id, h.PROPERTY_NO
	       from t_mortgage_house_info h
	      where h.PROPERTY_NO = '$propertyNo$')
        
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyAddres">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_addres='$propertyAddres$'
		  )
        </isNotEmpty>
        <isNotEmpty prepend=" and" property="noRegisterSign">
        t.NO_REGISTER_SIGN = '$noRegisterSign$'
        </isNotEmpty>
		</dynamic>
		
	
</select>
<!-- 补登记确认的日志记录插入 -->
<insert id="MortgageLog_insert" parameterClass="java.util.HashMap">
	<![CDATA[
		insert into T_MORTGAGE_LOG (ID,OPERATING_TIME,OPERATING_USERID,OPERATING_TYPE,OPERATING_MORTGAG_ID,OPERATING_REMARK)
		values (SEQ_T_MORTGAGE_LOG.NEXTVAL,to_char(sysdate,'yyyymmddHH24miss'),'$operatingUserId$','$operatingType$','$warrantsId$','$operatingRemark$')
	]]>
</insert>

<!-- 押品类型为房产的分类汇总统计表 -->
<select id="queryMortgageReserveHouseInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList1">
<!-- 	select T.type as TYPE,
       T.operating_matters as OPERATING_MATTERS,
       (select F.alls
          from (select a.type as type,
                       a.operating_matters as operating_matters,
                       count(*) as alls
                  from T_MORTGAGE_LIST a  
                  left join T_MORTGAGE_HOUSE_INFO b
                    on a.warrants_id = b.warrants_id
                   and a.operating_id = b.id
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
                 where 1=1 
			        <isNotEmpty prepend="and" property="mortgageType">
						c.MORTGAGE_TYPE='$mortgageType$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingTime">
						<![CDATA[
						substr(a.INSERT_TIME,0,8)>='$operatingTime$'
						]]>
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingEndTime">
						<![CDATA[
						substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
						]]>
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingMatters">
						a.OPERATING_MATTERS = '$operatingMatters$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingType">
						a.type='$operatingType$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="status">
						c.STATUS='$status$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="checkBoxStatus">
					<![CDATA[
						a.operating_matters='2' and a.borrower_log <> 4
					]]>
					</isNotEmpty>
                 group by a.type, a.operating_matters) F
         where T.type = F.type
           and T.operating_matters = F.operating_matters) as alls,
       sum(T.property_nums) as PROPERTY_NUMS,
       sum(T.otherWarrants_nums) as OTHERWARRANTS_NUMS
  from (select a.warrants_id,
               a.type              as type,
               a.operating_matters as operating_matters,
               MAX(b.property_nums) as property_nums,
               1 as otherWarrants_nums
         from T_MORTGAGE_LIST a  
                  left join T_MORTGAGE_HOUSE_INFO b
                    on a.warrants_id = b.warrants_id
                   and a.operating_id = b.id
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
         where 1=1
         <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' and a.borrower_log <> 4
			]]>
			</isNotEmpty>
         group by a.warrants_id, a.type, a.operating_matters) T
 group by T.type, T.operating_matters
	 -->
	 	select T.type as TYPE,
       T.operating_matters as OPERATING_MATTERS,
       (select F.alls
          from (select a.type as type,
                       a.operating_matters as operating_matters,
                       count(*) as alls
                  from T_MORTGAGE_LIST a
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
                 where 1 = 1
                <isNotEmpty prepend="and" property="mortgageType">
						c.MORTGAGE_TYPE='$mortgageType$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingTime">
						<![CDATA[
						substr(a.INSERT_TIME,0,8)>='$operatingTime$'
						]]>
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingEndTime">
						<![CDATA[
						substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
						]]>
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingMatters">
						a.OPERATING_MATTERS = '$operatingMatters$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="operatingType">
						a.type='$operatingType$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="status">
						c.STATUS='$status$'
					</isNotEmpty>
					<isNotEmpty prepend="and" property="checkBoxStatus">
					<![CDATA[
						a.operating_matters='2' 
						and 
						not exists (select distinct t.warrants_id
					  from T_MORTGAGE_LIST t
					 where a.warrants_id = t.warrants_id
					 and t.borrower_log = '4')
					]]>
					</isNotEmpty>
                 group by a.type, a.operating_matters) F
         where T.type = F.type
           and T.operating_matters = F.operating_matters) as alls,
       sum(T.property_nums) as PROPERTY_NUMS,
       sum(T.otherWarrants_nums) as OTHERWARRANTS_NUMS
  from (select a.warrants_id,
               a.type as type,
               a.operating_matters as operating_matters,
               sum(a.house_warrants_nums) as property_nums,
               MAX(a.other_warrants_nums) as otherWarrants_nums
          from T_MORTGAGE_LIST a
          left join T_WARRANTS_INFO c
            on a.warrants_id = c.id
         where 1 = 1
         <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' 
				and 
				not exists (select distinct t.warrants_id
			  from T_MORTGAGE_LIST t 
			 where a.warrants_id = t.warrants_id
			       and t.borrower_log = '4')
			]]>
			</isNotEmpty>
         group by a.warrants_id, a.type, a.operating_matters) T
 group by T.type, T.operating_matters
	 	
</select>
<!-- 押品类型为机动车的分类汇总统计表===== -->
<select id="queryMortgageReserveCarInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList3">
<!--  select T.type as TYPE,
       T.operating_matters as OPERATING_MATTERS,
       (select F.alls
          from (select a.type as type,
                       a.operating_matters as operating_matters,
                       count(*) as alls
                  from T_MORTGAGE_LIST a  
                  left join T_MORTGAGE_CAR_INFO b
                    on a.warrants_id = b.warrants_id
                   and a.operating_id = b.id
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
                 where 1=1
                 <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' and a.borrower_log <> 4
			]]>
			</isNotEmpty>
                 group by a.type, a.operating_matters) F
         where T.type = F.type
           and T.operating_matters = F.operating_matters) as alls,
       sum(T.cars) as cars,
       sum(T.otherWarrants_nums) as others
  from (select a.warrants_id,
               a.type              as type,
               a.operating_matters as operating_matters,
               count(b.warrants_id) as cars,
               1 as otherWarrants_nums
         from T_MORTGAGE_LIST a  
                  left join T_MORTGAGE_CAR_INFO b
                    on a.warrants_id = b.warrants_id
                   and a.operating_id = b.id
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
         where 1=1
         <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' and a.borrower_log <> 4
			]]>
		</isNotEmpty>
         group by a.warrants_id, a.type, a.operating_matters) T
 group by T.type, T.operating_matters
  -->
  select T.type as TYPE,
       T.operating_matters as OPERATING_MATTERS,
       (select F.alls
          from (select a.type as type,
                       a.operating_matters as operating_matters,
                       count(*) as alls
                  from T_MORTGAGE_LIST a
                  left join T_WARRANTS_INFO c
                    on a.warrants_id = c.id
                 where 1 = 1
                <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' 
				and 
			   not exists (select distinct t.warrants_id
			from T_MORTGAGE_LIST t
			where a.warrants_id = t.warrants_id
				  and t.borrower_log = '4')
			]]>
			</isNotEmpty>
                 group by a.type, a.operating_matters) F
         where T.type = F.type
           and T.operating_matters = F.operating_matters) as alls,
       sum(T.cars) as cars,
       sum(T.otherWarrants_nums) as others
  from (select a.warrants_id,
               a.type as type,
               a.operating_matters as operating_matters,
               sum(a.house_warrants_nums) as cars,
               MAX(a.other_warrants_nums) as otherWarrants_nums
          from T_MORTGAGE_LIST a
          left join T_WARRANTS_INFO c
            on a.warrants_id = c.id
         where 1 = 1
        <isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			a.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			a.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkBoxStatus">
			<![CDATA[
				a.operating_matters='2' 
				and 
			    not exists (select distinct t.warrants_id
			  from T_MORTGAGE_LIST t
			 where a.warrants_id = t.warrants_id
			       and t.borrower_log = '4')
			]]>
		</isNotEmpty>
         group by a.warrants_id, a.type, a.operating_matters) T
 group by T.type, T.operating_matters
  
</select>
<!-- 押品类型为房产的出入库明细表-->
<select id="queryMortgageReserveHouseDetailInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList2">
  select T.*, E.EMPNAME as OPERATING_USERID
  from (
        select d.id                    as ID,
           to_char(TO_DATE(a.operating_time, 'yyyyMMddhh24miss'),
                 'yyyy-mm-dd hh24:mi')   as OPERATING_TIME,
           d.type              as type,
           d.operating_matters     as OPERATING_MATTERS,
           c.project_number        as PROJECT_NUMBER,
           b.property_no           AS PROPERTY_NO,
           b.property_name         AS PROPERTY_NAME,
           c.other_warrants_number AS OTHER_WARRANTS_NUMBER,
           a.operating_userid      AS OPERATING_USERID2,
           d.BORROWER_NEXT_NAME    AS NEXT_NAME,
            d.borrower_nums         as borrower_nums,
           d.REMARK      AS OPERATING_REMARK,
           d.house_warrants_nums as HOUSE_WARRANTS_NUMS,
           d.other_warrants_nums as OTHER_WARRANTS_NUMS
      from T_MORTGAGE_LIST d
      left join T_MORTGAGE_LOG a
        on d.warrants_id = a.OPERATING_MORTGAG_ID and d.INSERT_TIME = a.OPERATING_TIME
      left join T_MORTGAGE_HOUSE_INFO b
        on d.warrants_id = b.warrants_id and d.OPERATING_ID = b.ID
      left join T_WARRANTS_INFO c
        on d.warrants_id = c.id
     where 1=1

   
  <dynamic>
    <isNotEmpty prepend="and" property="mortgageType">
      c.MORTGAGE_TYPE='$mortgageType$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingTime">
      <![CDATA[
      substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
      ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingEndTime">
      <![CDATA[
      substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
      ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingMatters">
      d.OPERATING_MATTERS = '$operatingMatters$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingType">
      d.type ='$operatingType$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="status">
      c.STATUS='$status$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkBoxStatus">
      <![CDATA[
        d.operating_matters='2' 
        and 
        not exists (select distinct t.warrants_id
	  from T_MORTGAGE_LIST t
	 where d.warrants_id = t.warrants_id
		   and t.borrower_log = '4')
      ]]>
    </isNotEmpty>
  </dynamic>
     ) T,
       OM_EMPLOYEE                 E
   WHERE T.OPERATING_USERID2 = E.EMPID
   order by T.OPERATING_TIME,T.TYPE,T.PROJECT_NUMBER
   
</select>
<!-- 押品类型为机动车的出入库明细表-->
<select id="queryMortgageReserveCarDetailInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList4">
select T.*, E.EMPNAME as OPERATING_USERID
  from ( 
        select d.id                AS id,
           to_char(TO_DATE(a.operating_time, 'yyyyMMddhh24miss'),
                 'yyyy-mm-dd hh24:mi')    AS operating_time,
           d.type              AS type,
           d.operating_matters AS operating_matters,
           c.project_number    AS project_number,
           b.car_no            AS car_no,
           b.car_name          AS car_name,
           a.operating_userid  AS operating_userid2,
           d.BORROWER_NEXT_NAME    AS next_name,
           d.borrower_nums         as borrower_nums,
           d.REMARK   AS operating_remark,
		   d.house_warrants_nums as HOUSE_WARRANTS_NUMS,
           d.other_warrants_nums as OTHER_WARRANTS_NUMS
      from T_MORTGAGE_LIST d
      left join T_MORTGAGE_CAR_INFO b
        on d.warrants_id = b.warrants_id and d.OPERATING_ID = b.ID
      left join T_WARRANTS_INFO c
        on d.warrants_id = c.id
      left join T_MORTGAGE_LOG a
        on d.warrants_id = a.OPERATING_MORTGAG_ID and d.INSERT_TIME = a.OPERATING_TIME
     where 1=1

  <dynamic>
    <isNotEmpty prepend="and" property="mortgageType">
      c.MORTGAGE_TYPE='$mortgageType$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingTime">
      <![CDATA[
      substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
      ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingEndTime">
      <![CDATA[
      substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
      ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingMatters">
      d.OPERATING_MATTERS = '$operatingMatters$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="operatingType">
      d.type ='$operatingType$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="status">
      c.STATUS='$status$'
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkBoxStatus">
      <![CDATA[
        d.operating_matters='2' 
        and 
        not exists (select distinct t.warrants_id
	  from T_MORTGAGE_LIST t
	 where d.warrants_id = t.warrants_id
		and t.borrower_log = '4')
      ]]>
    </isNotEmpty>
  </dynamic>
       ) T,
       OM_EMPLOYEE                 E
   WHERE T.OPERATING_USERID2 = E.EMPID
   order by T.OPERATING_TIME,T.TYPE,T.PROJECT_NUMBER
</select>
<select id="byOrgcodeFindParentorgid"   parameterClass="java.lang.String" resultClass="java.lang.String">
	<![CDATA[
	select o.PARENTORGID
	 from om_organization o
  where o.orgcode = '$orgcode$'
	
	   ]]>
	</select>
	<select id="queryOneOrgCode"  parameterClass="java.lang.String" resultClass="java.lang.String">
	<![CDATA[
	  select orgid from OM_ORGANIZATION where orgname='一类支行'
	   ]]>
	</select>
	<!-- 判断登陆用户的机构id是否属于一类支行 属于就返回1，不属于就返回0 -->
	<select id="judgeYesAndNoOneOrgCode"  parameterClass="java.lang.String" resultClass="java.lang.String">
	<![CDATA[
	  select count(orgcode) from 
      (select  o.orgcode
        from om_organization o
       start with orgid = (select orgid from OM_ORGANIZATION where orgname='一类支行')
      connect by prior orgid = parentorgid) tt
      where tt.orgcode='$orgcode$'
	   ]]>
	</select>

</sqlMap>
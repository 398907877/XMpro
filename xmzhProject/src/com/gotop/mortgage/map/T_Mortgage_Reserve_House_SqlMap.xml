<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="T_Mortgage_Reserve_House_SqlMap">
	<resultMap class="com.gotop.mortgage.model.MortgageReserveHouseCar" id="mortgageReserveHouseCar">
		<result column="WARRANTS_ID" property="warrantsId" jdbcType="VARCHAR"/>
     	<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR" />
     	<result column="LOAN_TYPE" property="loanType" jdbcType="VARCHAR" />
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR" />
     	<result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
     	<result column="STATUS" property="status" jdbcType="VARCHAR" />
     	<result column="OTHER_TYPE" property="otherType" jdbcType="VARCHAR" />
     	<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR" />
     </resultMap>
     
     <resultMap id="mortgageReserve" class="com.gotop.mortgage.model.MortgageReserve" >
    <!--Bean方式返回全表-->
    	<result column="ID" property="id" jdbcType="VARCHAR"/>
  		<result column="NO_REGISTER_SIGN" property="noRegisterSign" jdbcType="VARCHAR"/>
  </resultMap>
  <!-- 房产非外借bean -->
  <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList2">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="PROPERTY_NO" property="propertyNo" jdbcType="VARCHAR"/>
     	<result column="PROPERTY_NAME" property="propertyName" jdbcType="VARCHAR"/>
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
  		
  </resultMap>
  <!-- 房产外借bean -->
  <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList5">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="PROPERTY_NO" property="propertyNo" jdbcType="VARCHAR"/>
     	<result column="PROPERTY_NAME" property="propertyName" jdbcType="VARCHAR"/>
     	<result column="BORROWER_NUMS" property="borrowerNums" jdbcType="VARCHAR"/>
     	<result column="BORROWER_LOG" property="borrowerLog" jdbcType="VARCHAR"/>
     	<result column="OTHER_WARRANTS_NUMBER" property="otherWarrantsNumber" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
  		
  </resultMap>
  <!-- 机动车非外借Bean -->
  <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList4">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="CAR_NO" property="propertyNo" jdbcType="VARCHAR"/>
     	<result column="CAR_NAME" property="propertyName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
  		
  </resultMap>
  <!-- 机动车外借Bean -->
   <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList6">
  		<result column="ID" property="id" jdbcType="VARCHAR"/>
     	<result column="OPERATING_TIME" property="operatingTime" jdbcType="VARCHAR"/>
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
  		<result column="PROJECT_NUMBER" property="projectNumber" jdbcType="VARCHAR"/>
  		<result column="CAR_NO" property="propertyNo" jdbcType="VARCHAR"/>
     	<result column="CAR_NAME" property="propertyName" jdbcType="VARCHAR"/>
     	<result column="BORROWER_NUMS" property="borrowerNums" jdbcType="VARCHAR"/>
     	<result column="BORROWER_LOG" property="borrowerLog" jdbcType="VARCHAR"/>
     	<result column="OPERATING_USERID" property="operatingUserId" jdbcType="VARCHAR"/>
     	<result column="NEXT_NAME" property="nextName" jdbcType="VARCHAR"/>
     	<result column="OPERATING_REMARK" property="operatingRemark" jdbcType="VARCHAR"/>
  		
  </resultMap>
     
     <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList1">
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
     	<result column="PROPERTY_NUMS" property="propertyNums" jdbcType="VARCHAR"/>
     	<result column="alls" property="alls" jdbcType="VARCHAR"/>
     </resultMap>
     <resultMap class="com.gotop.mortgage.model.MortgageList" id="mortgageList3">
     	<result column="type" property="type" jdbcType="VARCHAR"/>
     	<result column="OPERATING_MATTERS" property="operatingMatters" jdbcType="VARCHAR"/>
     	<result column="alls" property="alls" jdbcType="VARCHAR"/>
     	<result column="cars" property="cars" jdbcType="VARCHAR"/>
     	<result column="others" property="others" jdbcType="VARCHAR"/>
     </resultMap>
     
     
     <select id="queryMortgageReserveHouseList" parameterClass="java.util.HashMap" resultMap="mortgageReserveHouseCar">
		select t.id as WARRANTS_ID,
       t.no_register_sign as no_Register_Sign,
       t.other_type as OTHER_TYPE,
       t.project_number as PROJECT_NUMBER,
       t.loan_type as LOAN_TYPE,
       t.other_warrants_number as OTHER_WARRANTS_NUMBER,
       t.borrower_name as BORROWER_NAME,
       t.status as status
       from t_warrants_info t
       where 1=1

		<dynamic>  
       <isNotEmpty prepend=" and" property="propertyName">
         t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_name like '%$propertyName$%'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyCardNo">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_cardno='$propertyCardNo$'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyNo">
        t.id in(select h.warrants_id, h.PROPERTY_NO
	       from t_mortgage_house_info h
	      where h.PROPERTY_NO = '$propertyNo$')
        
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyAddres">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_addres='$propertyAddres$'
		  )
        </isNotEmpty>
        <isNotEmpty prepend=" and" property="noRegisterSign">
        t.NO_REGISTER_SIGN = '$noRegisterSign$'
        </isNotEmpty>
		</dynamic>
		
  </select>  
  <select id="queryMortgageReserveById" parameterClass="java.util.HashMap" resultMap="mortgageReserve">
  	select a.id as id,a.no_register_sign as NO_REGISTER_SIGN from T_WARRANTS_INFO a 
  	 where a.id='$id$'
  </select>
  <update id="noRegisterSignUpdate" parameterClass="java.util.HashMap">
  update T_WARRANTS_INFO a set 
        NO_REGISTER_SIGN = '$noRegisterSign$'
  where a.ID='$id$'
  </update>
     
<select id="queryMortgageQueryForExcel" parameterClass="java.util.HashMap" resultMap="mortgageReserveHouseCar">
	select t.id as WARRANTS_ID,
       t.no_register_sign as no_Register_Sign,
       t.other_type as OTHER_TYPE,
       t.project_number as PROJECT_NUMBER,
       t.loan_type as LOAN_TYPE,
       t.other_warrants_number as OTHER_WARRANTS_NUMBER,
       t.borrower_name as BORROWER_NAME,
       t.status as status
       from t_warrants_info t
       where 1=1

		<dynamic>  
       <isNotEmpty prepend=" and" property="propertyName">
         t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_name like '%$propertyName$%'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyCardNo">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_cardno='$propertyCardNo$'
		  )
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyNo">
        t.id in(select h.warrants_id, h.PROPERTY_NO
	       from t_mortgage_house_info h
	      where h.PROPERTY_NO = '$propertyNo$')
        
        </isNotEmpty>
       <isNotEmpty prepend=" and" property="propertyAddres">
        t.id in (select h.warrants_id
		  from t_mortgage_house_info h
		 where h.property_addres='$propertyAddres$'
		  )
        </isNotEmpty>
        <isNotEmpty prepend=" and" property="noRegisterSign">
        t.NO_REGISTER_SIGN = '$noRegisterSign$'
        </isNotEmpty>
		</dynamic>
		
	
</select>
<!-- 补登记确认的日志记录插入 -->
<insert id="MortgageLog_insert" parameterClass="java.util.HashMap">
	<![CDATA[
		insert into T_MORTGAGE_LOG (ID,OPERATING_TIME,OPERATING_USERID,OPERATING_TYPE,OPERATING_MORTGAG_ID,OPERATING_REMARK)
		values (SEQ_T_MORTGAGE_LOG.NEXTVAL,to_char(sysdate,'yyyymmddHH24miss'),'$operatingUserId$','$operatingType$','$warrantsId$','$operatingRemark$')
	]]>
</insert>

<!-- 押品类型为房产的分类汇总统计表 -->
<select id="queryMortgageReserveHouseInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList1">
	select b.type as type,
       b.operating_matters as operating_matters,
       count(b.type) as alls,
       a.property_nums as property_nums
	  from T_MORTGAGE_HOUSE_INFO a
	  left join T_MORTGAGE_LIST b
	    on a.warrants_id = b.warrants_id
	  left join T_WARRANTS_INFO c
	    on a.warrants_id = c.id
	 where 1 = 1

     

	<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(b.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(b.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			b.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			b.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	
	group by b.type, b.operating_matters, a.property_nums
	
		
</select>
<!-- 押品类型为机动车的分类汇总统计表===== -->
<select id="queryMortgageReserveCarInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList3">
  select b.type as type,
           b.operating_matters as operating_matters,
           count(b.type) as alls,
           count(a.warrants_id) as cars,
           count(a.warrants_id) as others
      from T_MORTGAGE_CAR_INFO a
      left join T_MORTGAGE_LIST b
        on a.warrants_id = b.warrants_id
      left join T_WARRANTS_INFO c
	    on a.warrants_id = c.id
     where 1 = 1

<dynamic>
		<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(b.INSERT_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(b.INSERT_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			b.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			b.type='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	</dynamic>
 group by b.type, b.operating_matters
</select>
<!-- 押品类型为房产的出入库明细表 -->
<select id="queryMortgageReserveHouseDetailInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList2">
	      select d.id                    as ID,
           a.operating_time        as OPERATING_TIME,
           d.type       		   as type,
           d.operating_matters     as OPERATING_MATTERS,
           c.project_number        as PROJECT_NUMBER,
           b.property_no           AS PROPERTY_NO,
           b.property_name         AS PROPERTY_NAME,
           c.other_warrants_number AS OTHER_WARRANTS_NUMBER,
           a.operating_userid      AS OPERATING_USERID,
           c.next_name             AS NEXT_NAME,
           a.operating_remark      AS OPERATING_REMARK
      from T_MORTGAGE_LIST d
      left join T_MORTGAGE_LOG a
        on d.warrants_id = a.OPERATING_MORTGAG_ID
      left join T_MORTGAGE_HOUSE_INFO b
        on d.warrants_id = b.warrants_id
      left join T_WARRANTS_INFO c
        on d.warrants_id = c.id
     where 1 = 1

	 
	<dynamic>
		<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			d.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			d.type ='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	</dynamic>
		
</select>
<!-- 押品类型为机动车的出入库明细表 -->
<select id="queryMortgageReserveCarDetailInOutList" parameterClass="java.util.HashMap" resultMap="mortgageList4">
	      select d.id                AS id,
           a.operating_time    AS operating_time,
           d.type              AS type,
           d.operating_matters AS operating_matters,
           c.project_number    AS project_number,
           b.car_no            AS car_no,
           b.car_name          AS car_name,
           a.operating_userid  AS operating_userid,
           c.next_name         AS next_name,
           a.operating_remark  AS operating_remark
      from T_MORTGAGE_LIST d
      left join T_MORTGAGE_CAR_INFO b
        on d.warrants_id = b.warrants_id
      left join T_WARRANTS_INFO c
        on d.warrants_id = c.id
      left join T_MORTGAGE_LOG a
        on d.warrants_id = a.OPERATING_MORTGAG_ID
     where 1 = 1

  <dynamic>
		<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			d.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			d.type ='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	</dynamic>

</select>
<!-- 房产外借明细表 -->

<select id="queryMortgageReserveHouseDetailInOutList1" parameterClass="java.util.HashMap" resultMap="mortgageList5">
	select d.id                    as ID,
           a.operating_time        as OPERATING_TIME,
           d.type       		   as type,
           d.operating_matters     as OPERATING_MATTERS,
           c.project_number        as PROJECT_NUMBER,
           b.property_no           AS PROPERTY_NO,
           b.property_name         AS PROPERTY_NAME,
           d.borrower_nums         as borrower_nums,
           d.borrower_log          as borrower_log,
           c.other_warrants_number AS OTHER_WARRANTS_NUMBER,
           a.operating_userid      AS OPERATING_USERID,
           c.next_name             AS NEXT_NAME,
           a.operating_remark      AS OPERATING_REMARK
      from T_MORTGAGE_LIST d
      left join T_MORTGAGE_LOG a
        on d.warrants_id = a.OPERATING_MORTGAG_ID
      left join T_MORTGAGE_HOUSE_INFO b
        on d.warrants_id = b.warrants_id
      left join T_WARRANTS_INFO c
        on d.warrants_id = c.id
     where 1 = 1
	<dynamic>
		<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			d.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			d.type ='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	</dynamic>

</select>
 <!-- 机动车外借明细表 -->
 <select id="queryMortgageReserveCarDetailInOutList1" parameterClass="java.util.HashMap" resultMap="mortgageList6">
 	     select d.id                AS id,
            a.operating_time    AS operating_time,
            d.type              AS type,
            d.operating_matters AS operating_matters,
            c.project_number    AS project_number,
            b.car_no            AS car_no,
            b.car_name          AS car_name,
            d.borrower_nums     as borrower_nums,
            d.borrower_log      as borrower_log,
            a.operating_userid  AS operating_userid,
            c.next_name         AS next_name,
            a.operating_remark  AS operating_remark
       from T_MORTGAGE_LIST d
       left join T_MORTGAGE_CAR_INFO b
         on d.warrants_id = b.warrants_id
       left join T_WARRANTS_INFO c
         on d.warrants_id = c.id
       left join T_MORTGAGE_LOG a
         on d.warrants_id = a.OPERATING_MORTGAG_ID
      where 1 = 1
 	<dynamic>
		<isNotEmpty prepend="and" property="mortgageType">
			c.MORTGAGE_TYPE='$mortgageType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)>='$operatingTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingEndTime">
			<![CDATA[
			substr(a.OPERATING_TIME,0,8)<='$operatingEndTime$'
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingMatters">
			d.OPERATING_MATTERS = '$operatingMatters$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="operatingType">
			d.type ='$operatingType$'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			c.STATUS='$status$'
		</isNotEmpty>
	</dynamic>
 
 
 </select>


</sqlMap>